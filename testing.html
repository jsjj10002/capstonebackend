<!DOCTYPE html>
<html>
<head>
  <title>일기 앱 백엔드 API 테스트 (v2.0)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .section {
      background: white;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .section-header {
      background-color: #f8f9fa;
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-content {
      padding: 20px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #495057;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #dee2e6;
      background-color: #f8f9fa;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .tab {
      display: flex;
      background-color: #e9ecef;
      border-radius: 8px 8px 0 0;
      overflow: hidden;
    }
    
    .tab button {
      background-color: transparent;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 15px 20px;
      transition: 0.3s;
      color: #495057;
      font-weight: 600;
      margin: 0;
      border-radius: 0;
    }
    
    .tab button:hover {
      background-color: #dee2e6;
      transform: none;
      box-shadow: none;
    }
    
    .tab button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .tabcontent {
      display: none;
      padding: 0;
    }
    
    .tabcontent.show {
      display: block;
    }
    
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-online { background-color: #28a745; }
    .status-offline { background-color: #dc3545; }
    .status-unknown { background-color: #6c757d; }
    
    .required {
      color: #dc3545;
    }
    
    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    
    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>일기 앱 백엔드 API 테스트</h1>
    <p>v2.0 - 업데이트된 API 명세에 맞춘 완전한 테스트 도구</p>
    <div id="connectionStatus">
      <span class="status-indicator status-unknown"></span>
      서버 연결 상태: 확인 중...
    </div>
  </div>

  <div class="section">
    <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'userSection')">👤 사용자 관리</button>
      <button class="tablinks" onclick="openTab(event, 'peopleSection')">👥 인물 관리</button>
      <button class="tablinks" onclick="openTab(event, 'diarySection')">📔 일기 관리</button>
      <button class="tablinks" onclick="openTab(event, 'systemSection')">🛠️ 시스템 상태</button>
    </div>

    <div id="userSection" class="tabcontent show">
      <!-- 회원가입 -->
      <div class="section">
        <div class="section-header">
          <h3>👤 회원가입</h3>
          <code>POST /api/users/register</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="registerUsername">사용자 이름 <span class="required">*</span></label>
                <input type="text" id="registerUsername" placeholder="사용자 이름">
              </div>
              <div class="form-group">
                <label for="registerEmail">이메일 <span class="required">*</span></label>
                <input type="email" id="registerEmail" placeholder="user@example.com">
              </div>
              <div class="form-group">
                <label for="registerPassword">비밀번호 <span class="required">*</span></label>
                <input type="password" id="registerPassword" placeholder="최소 6자">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="registerGender">성별 <span class="required">*</span></label>
                <select id="registerGender">
                  <option value="">성별 선택</option>
                  <option value="남성">남성</option>
                  <option value="여성">여성</option>
                  <option value="기타">기타</option>
                </select>
              </div>
              <div class="form-group">
                <label for="registerProfilePhoto">프로필 사진</label>
                <input type="file" id="registerProfilePhoto" accept="image/*">
              </div>
            </div>
          </div>
          <button id="registerButton" onclick="registerUser()">회원가입</button>
          <div id="registerResult" class="result"></div>
        </div>
      </div>

      <!-- 로그인 -->
      <div class="section">
        <div class="section-header">
          <h3>🔑 로그인</h3>
          <code>POST /api/users/login</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="loginEmail">이메일 <span class="required">*</span></label>
                <input type="email" id="loginEmail" placeholder="user@example.com">
              </div>
              <div class="form-group">
                <label for="loginPassword">비밀번호 <span class="required">*</span></label>
                <input type="password" id="loginPassword" placeholder="비밀번호">
              </div>
            </div>
          </div>
          <button id="loginButton" onclick="loginUser()">로그인</button>
          <div id="loginResult" class="result"></div>
        </div>
      </div>

      <!-- 프로필 조회 -->
      <div class="section">
        <div class="section-header">
          <h3>👤 프로필 조회</h3>
          <code>GET /api/users/profile</code>
        </div>
        <div class="section-content">
          <button id="getProfileButton" onclick="getUserProfile()">내 프로필 조회</button>
          <div id="profileResult" class="result"></div>
        </div>
      </div>

      <!-- 프로필 사진 업데이트 -->
      <div class="section">
        <div class="section-header">
          <h3>📷 프로필 사진 업데이트</h3>
          <code>PUT /api/users/profile/photo</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="updateProfilePhoto">새 프로필 사진 <span class="required">*</span></label>
            <input type="file" id="updateProfilePhoto" accept="image/*">
          </div>
          <button id="updateProfileButton" onclick="updateUserProfilePhoto()">프로필 사진 업데이트</button>
          <div id="updateProfileResult" class="result"></div>
        </div>
      </div>

      <!-- 프로필 정보 수정 -->
      <div class="section">
        <div class="section-header">
          <h3>✏️ 프로필 정보 수정</h3>
          <code>PUT /api/users/profile</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="updateUsername">새 사용자 이름</label>
                <input type="text" id="updateUsername" placeholder="새 사용자 이름 (선택)">
              </div>
              <div class="form-group">
                <label for="updateEmail">새 이메일</label>
                <input type="email" id="updateEmail" placeholder="새 이메일 (선택)">
              </div>
            </div>
          </div>
          <button id="updateUserInfoButton" onclick="updateUserInfo()">프로필 정보 수정</button>
          <div id="updateUserInfoResult" class="result"></div>
        </div>
      </div>

      <!-- 비밀번호 변경 -->
      <div class="section">
        <div class="section-header">
          <h3>🔒 비밀번호 변경</h3>
          <code>PUT /api/users/profile/password</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="currentPassword">현재 비밀번호 <span class="required">*</span></label>
                <input type="password" id="currentPassword" placeholder="현재 비밀번호">
              </div>
              <div class="form-group">
                <label for="newPassword">새 비밀번호 <span class="required">*</span></label>
                <input type="password" id="newPassword" placeholder="새 비밀번호 (최소 6자)">
              </div>
            </div>
          </div>
          <button id="changePasswordButton" onclick="changePassword()">비밀번호 변경</button>
          <div id="changePasswordResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- 다른 섹션들은 다음 단계에서 추가 -->
    <div id="peopleSection" class="tabcontent">
      <!-- 새 인물 추가 -->
      <div class="section">
        <div class="section-header">
          <h3>➕ 새 인물 추가</h3>
          <code>POST /api/people</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="personName">이름 <span class="required">*</span></label>
                <input type="text" id="personName" placeholder="인물 이름">
              </div>
              <div class="form-group">
                <label for="personGender">성별</label>
                <select id="personGender">
                  <option value="">선택 안함</option>
                  <option value="남성">남성</option>
                  <option value="여성">여성</option>
                  <option value="기타">기타</option>
                </select>
              </div>
              <div class="form-group">
                <label for="personPhoto">사진 <span class="required">*</span></label>
                <input type="file" id="personPhoto" accept="image/*">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="personHairStyle">헤어스타일</label>
                <input type="text" id="personHairStyle" placeholder="예: 긴 생머리, 단발, 곱슬머리">
              </div>
              <div class="form-group">
                <label for="personClothing">의상</label>
                <input type="text" id="personClothing" placeholder="예: 캐주얼, 정장, 운동복">
              </div>
              <div class="form-group">
                <label for="personAccessories">악세사리</label>
                <input type="text" id="personAccessories" placeholder="예: 안경, 목걸이, 모자">
              </div>
            </div>
          </div>
          <button id="addPersonButton" onclick="addPerson()">인물 추가</button>
          <div id="addPersonResult" class="result"></div>
        </div>
      </div>

      <!-- 인물 목록 조회 -->
      <div class="section">
        <div class="section-header">
          <h3>📋 내 인물 목록</h3>
          <code>GET /api/people</code>
        </div>
        <div class="section-content">
          <button id="getMyPeopleButton" onclick="getMyPeople()">인물 목록 조회</button>
          <div id="myPeopleResult" class="result"></div>
        </div>
      </div>

      <!-- 인물 검색 -->
      <div class="section">
        <div class="section-header">
          <h3>🔍 인물 검색</h3>
          <code>GET /api/people/search</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="personSearchKeyword">검색어</label>
            <input type="text" id="personSearchKeyword" placeholder="인물 이름으로 검색">
          </div>
          <button id="searchPeopleButton" onclick="searchPeople()">인물 검색</button>
          <div id="searchPeopleResult" class="result"></div>
        </div>
      </div>

      <!-- 특정 인물 조회/수정/삭제 -->
      <div class="section">
        <div class="section-header">
          <h3>✏️ 인물 관리</h3>
          <code>GET/PUT/DELETE /api/people/{id}</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="personId">인물 ID <span class="required">*</span></label>
            <input type="text" id="personId" placeholder="인물 ID를 입력하세요">
          </div>
          
          <button id="getPersonButton" onclick="getPersonById()">인물 조회</button>
          <div id="getPersonResult" class="result"></div>
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid #dee2e6;">
          
          <h4>인물 정보 수정</h4>
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="updatePersonName">이름</label>
                <input type="text" id="updatePersonName" placeholder="수정할 이름">
              </div>
              <div class="form-group">
                <label for="updatePersonGender">성별</label>
                <select id="updatePersonGender">
                  <option value="">변경 안함</option>
                  <option value="남성">남성</option>
                  <option value="여성">여성</option>
                  <option value="기타">기타</option>
                </select>
              </div>
              <div class="form-group">
                <label for="updatePersonPhoto">새 사진</label>
                <input type="file" id="updatePersonPhoto" accept="image/*">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="updatePersonHairStyle">헤어스타일</label>
                <input type="text" id="updatePersonHairStyle" placeholder="수정할 헤어스타일">
              </div>
              <div class="form-group">
                <label for="updatePersonClothing">의상</label>
                <input type="text" id="updatePersonClothing" placeholder="수정할 의상">
              </div>
              <div class="form-group">
                <label for="updatePersonAccessories">악세사리</label>
                <input type="text" id="updatePersonAccessories" placeholder="수정할 악세사리">
              </div>
            </div>
          </div>
          
          <button id="updatePersonButton" onclick="updatePerson()">인물 정보 수정</button>
          <button id="deletePersonButton" onclick="deletePerson()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">인물 삭제</button>
          
          <div id="updatePersonResult" class="result"></div>
        </div>
      </div>
    </div>

    <div id="diarySection" class="tabcontent">
      <!-- 일기 작성 -->
      <div class="section">
        <div class="section-header">
          <h3>✍️ 일기 작성</h3>
          <code>POST /api/diaries</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="diaryContent">일기 내용 <span class="required">*</span></label>
                <textarea id="diaryContent" rows="6" placeholder="일기 내용을 입력하세요. (@이름 형식으로 주인공 지정 가능)"></textarea>
              </div>
              <div class="form-group">
                <label for="diaryDate">일기 날짜</label>
                <input type="date" id="diaryDate">
              </div>
              <div class="form-group">
                <label for="diaryArtStyle">화풍 선택 <span class="required">*</span></label>
                <select id="diaryArtStyle">
                  <option value="">화풍 선택</option>
                  <option value="realistic">사실적 (Realistic)</option>
                  <option value="makoto_shinkai">신카이 마코토 (Makoto Shinkai)</option>
                  <option value="watercolor">수채화 (Watercolor)</option>
                  <option value="oil_painting">유화 (Oil Painting)</option>
                </select>
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="diaryPhotos">사진 (최대 5개)</label>
                <input type="file" id="diaryPhotos" accept="image/*" multiple>
              </div>
              
              <div style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-top: 15px;">
                <h4 style="margin-top: 0;">주인공 정보 (연락처에 없는 사람일 경우)</h4>
                <div class="form-group">
                  <label for="tempGender">성별</label>
                  <select id="tempGender">
                    <option value="">선택 안함</option>
                    <option value="남성">남성</option>
                    <option value="여성">여성</option>
                    <option value="기타">기타</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="tempHairStyle">헤어스타일</label>
                  <input type="text" id="tempHairStyle" placeholder="예: 긴 생머리, 단발">
                </div>
                <div class="form-group">
                  <label for="tempClothing">의상</label>
                  <input type="text" id="tempClothing" placeholder="예: 캐주얼, 정장">
                </div>
                <div class="form-group">
                  <label for="tempAccessories">악세사리</label>
                  <input type="text" id="tempAccessories" placeholder="예: 안경, 목걸이">
                </div>
              </div>
            </div>
          </div>
          <button id="createDiaryButton" onclick="createDiary()">일기 작성 (자동 이미지 생성)</button>
          <div id="createDiaryResult" class="result"></div>
          <div id="generatedDiaryImage" style="margin-top: 15px;"></div>
        </div>
      </div>

      <!-- 일기 목록 조회 -->
      <div class="section">
        <div class="section-header">
          <h3>📋 일기 목록 조회</h3>
          <code>GET /api/diaries</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="diaryPage">페이지</label>
                <input type="number" id="diaryPage" value="1" min="1" placeholder="페이지 번호">
              </div>
              <div class="form-group">
                <label for="diaryLimit">페이지당 개수</label>
                <input type="number" id="diaryLimit" value="10" min="1" max="50" placeholder="10">
              </div>
            </div>
          </div>
          <button id="getMyDiariesButton" onclick="getMyDiaries()">내 일기 목록 조회</button>
          <div id="myDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- 월별 일기 조회 -->
      <div class="section">
        <div class="section-header">
          <h3>📅 월별 일기 조회</h3>
          <code>GET /api/diaries/monthly</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="monthlyYear">년도 <span class="required">*</span></label>
                <input type="number" id="monthlyYear" value="2025" min="2000" max="2030" placeholder="2025">
              </div>
              <div class="form-group">
                <label for="monthlyMonth">월 <span class="required">*</span></label>
                <input type="number" id="monthlyMonth" value="1" min="1" max="12" placeholder="1">
              </div>
            </div>
          </div>
          <button id="getMonthlyDiariesButton" onclick="getMonthlyDiaries()">월별 일기 조회</button>
          <div id="monthlyDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- 일기 검색 -->
      <div class="section">
        <div class="section-header">
          <h3>🔍 일기 검색</h3>
          <code>GET /api/diaries/search</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="diarySearchKeyword">검색어</label>
            <input type="text" id="diarySearchKeyword" placeholder="일기 내용으로 검색">
          </div>
          <button id="searchDiaryButton" onclick="searchDiaries()">일기 검색</button>
          <div id="searchDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- 특정 일기 조회/수정/삭제 -->
      <div class="section">
        <div class="section-header">
          <h3>✏️ 일기 관리</h3>
          <code>GET/PUT/DELETE /api/diaries/{id}</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="diaryId">일기 ID <span class="required">*</span></label>
            <input type="text" id="diaryId" placeholder="일기 ID를 입력하세요">
          </div>
          
          <button id="getDiaryButton" onclick="getDiaryById()">일기 조회</button>
          <div id="getDiaryResult" class="result"></div>
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid #dee2e6;">
          
          <h4>일기 수정</h4>
          <div class="form-group">
            <label for="updateDiaryContent">내용</label>
            <textarea id="updateDiaryContent" rows="5" placeholder="수정할 내용"></textarea>
          </div>
          <div class="form-group">
            <label for="updateDiaryPhotos">추가 사진</label>
            <input type="file" id="updateDiaryPhotos" accept="image/*" multiple>
          </div>
          
          <button id="updateDiaryButton" onclick="updateDiary()">일기 수정</button>
          <button id="deleteDiaryButton" onclick="deleteDiary()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">일기 삭제</button>
          
          <div id="updateDiaryResult" class="result"></div>
        </div>
      </div>

      <!-- 프롬프트 로그 조회 -->
      <div class="section">
        <div class="section-header">
          <h3>📝 프롬프트 로그 조회</h3>
          <code>GET /api/diaries/{id}/prompt-log</code>
        </div>
        <div class="section-content">
          <p>일기 작성 시 자동 생성된 이미지의 프롬프트 로그를 조회합니다. 위의 일기 ID를 사용하세요.</p>
          <button id="getPromptLogButton" onclick="getDiaryPromptLog()">프롬프트 로그 조회</button>
          <div id="promptLogResult" class="result"></div>
        </div>
      </div>
    </div>

    <div id="systemSection" class="tabcontent">
      <!-- 서버 상태 확인 -->
      <div class="section">
        <div class="section-header">
          <h3>🔗 서버 상태 확인</h3>
          <code>GET /api/ping</code>
        </div>
        <div class="section-content">
          <p>백엔드 서버의 기본 상태를 확인합니다.</p>
          <button id="pingServerButton" onclick="pingServer()">서버 상태 확인</button>
          <div id="pingServerResult" class="result"></div>
        </div>
      </div>

      <!-- ComfyUI 연결 테스트 -->
      <div class="section">
        <div class="section-header">
          <h3>🎨 ComfyUI 연결 테스트</h3>
          <code>GET /api/test-comfyui</code>
        </div>
        <div class="section-content">
          <p>ComfyUI 서버의 연결 상태와 응답 시간을 테스트합니다.</p>
          <button id="testComfyUIButton" onclick="testComfyUIConnection()">ComfyUI 서버 테스트</button>
          <div id="testComfyUIResult" class="result"></div>
        </div>
      </div>

      <!-- API 전체 상태 요약 -->
      <div class="section">
        <div class="section-header">
          <h3>📊 API 상태 요약</h3>
          <code>전체 시스템 상태</code>
        </div>
        <div class="section-content">
          <p>모든 주요 엔드포인트와 외부 서비스의 상태를 한번에 확인합니다.</p>
          <button id="fullSystemCheckButton" onclick="fullSystemCheck()">전체 시스템 상태 확인</button>
          <div id="fullSystemCheckResult" class="result"></div>
        </div>
      </div>

      <!-- 토큰 상태 -->
      <div class="section">
        <div class="section-header">
          <h3>🔑 인증 상태</h3>
          <code>JWT Token Status</code>
        </div>
        <div class="section-content">
          <div id="tokenStatus" style="padding: 15px; background-color: #f8f9fa; border-radius: 6px; margin-bottom: 15px;">
            <strong>현재 토큰 상태:</strong> <span id="tokenStatusText">확인 중...</span>
          </div>
          <button onclick="checkTokenStatus()">토큰 상태 확인</button>
          <button onclick="clearToken()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">토큰 삭제</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API 기본 설정
    const API_URL = 'http://localhost:5000/api';
    let authToken = localStorage.getItem('authToken');
    
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      checkServerStatus();
      checkTokenStatus();
    });
    
    // 탭 기능
    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("show");
      }
      
      const tablinks = document.getElementsByClassName("tablinks");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }
      
      document.getElementById(tabName).classList.add("show");
      evt.currentTarget.classList.add("active");
    }
    
    // 서버 상태 확인
    async function checkServerStatus() {
      try {
        const response = await fetch(`${API_URL}/ping`);
        const data = await response.json();
        
        const statusElement = document.getElementById('connectionStatus');
        if (response.ok && data.status === 'ok') {
          statusElement.innerHTML = '<span class="status-indicator status-online"></span>서버 연결 상태: 온라인';
        } else {
          statusElement.innerHTML = '<span class="status-indicator status-offline"></span>서버 연결 상태: 오프라인';
        }
      } catch (error) {
        const statusElement = document.getElementById('connectionStatus');
        statusElement.innerHTML = '<span class="status-indicator status-offline"></span>서버 연결 상태: 연결 실패';
      }
    }
    
    // 버튼 로딩 상태 관리
    function setButtonLoading(buttonId, isLoading, originalText = null) {
      const button = document.getElementById(buttonId);
      if (!button) return;
      
      if (isLoading) {
        button.disabled = true;
        button.originalText = button.textContent;
        button.textContent = "처리 중...";
      } else {
        button.disabled = false;
        button.textContent = originalText || button.originalText || button.textContent;
      }
    }
    
    // 결과 표시 헬퍼 함수
    function displayResult(elementId, data, isSuccess = true) {
      const element = document.getElementById(elementId);
      element.textContent = JSON.stringify(data, null, 2);
      element.className = `result ${isSuccess ? 'success' : 'error'}`;
    }
    
    // 사용자 관리 함수들
    async function registerUser() {
      try {
        setButtonLoading('registerButton', true);
        
        const username = document.getElementById('registerUsername').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const gender = document.getElementById('registerGender').value;
        const profilePhoto = document.getElementById('registerProfilePhoto').files[0];
        
        if (!username || !email || !password || !gender) {
          displayResult('registerResult', { error: '필수 필드를 모두 입력해주세요.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('username', username);
        formData.append('email', email);
        formData.append('password', password);
        formData.append('gender', gender);
        if (profilePhoto) {
          formData.append('profilePhoto', profilePhoto);
        }
        
        const response = await fetch(`${API_URL}/users/register`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        displayResult('registerResult', data, response.ok);
        
        if (response.ok && data.token) {
          localStorage.setItem('authToken', data.token);
          authToken = data.token;
          alert('회원가입 성공! 자동으로 로그인되었습니다.');
        }
      } catch (err) {
        displayResult('registerResult', { error: err.message }, false);
      } finally {
        setButtonLoading('registerButton', false);
      }
    }
    
    async function loginUser() {
      try {
        setButtonLoading('loginButton', true);
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        if (!email || !password) {
          displayResult('loginResult', { error: '이메일과 비밀번호를 모두 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/login`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        displayResult('loginResult', data, response.ok);
        
        if (response.ok && data.token) {
          localStorage.setItem('authToken', data.token);
          authToken = data.token;
          alert('로그인 성공!');
        }
      } catch (err) {
        displayResult('loginResult', { error: err.message }, false);
      } finally {
        setButtonLoading('loginButton', false);
      }
    }
    
    async function getUserProfile() {
      try {
        setButtonLoading('getProfileButton', true);
        
        if (!authToken) {
          displayResult('profileResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/profile`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('profileResult', data, response.ok);
      } catch (err) {
        displayResult('profileResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getProfileButton', false);
      }
    }
    
    async function updateUserProfilePhoto() {
      try {
        setButtonLoading('updateProfileButton', true);
        
        if (!authToken) {
          displayResult('updateProfileResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const profilePhoto = document.getElementById('updateProfilePhoto').files[0];
        if (!profilePhoto) {
          displayResult('updateProfileResult', { error: '프로필 사진을 선택해주세요.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('profilePhoto', profilePhoto);
        
        const response = await fetch(`${API_URL}/users/profile/photo`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updateProfileResult', data, response.ok);
      } catch (err) {
        displayResult('updateProfileResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateProfileButton', false);
      }
    }
    
    async function updateUserInfo() {
      try {
        setButtonLoading('updateUserInfoButton', true);
        
        if (!authToken) {
          displayResult('updateUserInfoResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const username = document.getElementById('updateUsername').value;
        const email = document.getElementById('updateEmail').value;
        
        if (!username && !email) {
          displayResult('updateUserInfoResult', { error: '수정할 정보를 입력해주세요.' }, false);
          return;
        }
        
        const updateData = {};
        if (username) updateData.username = username;
        if (email) updateData.email = email;
        
        const response = await fetch(`${API_URL}/users/profile`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        });
        
        const data = await response.json();
        displayResult('updateUserInfoResult', data, response.ok);
      } catch (err) {
        displayResult('updateUserInfoResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateUserInfoButton', false);
      }
    }
    
    async function changePassword() {
      try {
        setButtonLoading('changePasswordButton', true);
        
        if (!authToken) {
          displayResult('changePasswordResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        
        if (!currentPassword || !newPassword) {
          displayResult('changePasswordResult', { error: '현재 비밀번호와 새 비밀번호를 모두 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/profile/password`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });
        
        const data = await response.json();
        displayResult('changePasswordResult', data, response.ok);
      } catch (err) {
        displayResult('changePasswordResult', { error: err.message }, false);
      } finally {
        setButtonLoading('changePasswordButton', false);
      }
    }
    
    // 인물 관리 함수들
    async function addPerson() {
      try {
        setButtonLoading('addPersonButton', true);
        
        if (!authToken) {
          displayResult('addPersonResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const name = document.getElementById('personName').value;
        const gender = document.getElementById('personGender').value;
        const hairStyle = document.getElementById('personHairStyle').value;
        const clothing = document.getElementById('personClothing').value;
        const accessories = document.getElementById('personAccessories').value;
        const photo = document.getElementById('personPhoto').files[0];
        
        if (!name || !photo) {
          displayResult('addPersonResult', { error: '이름과 사진은 필수입니다.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('name', name);
        if (gender) formData.append('gender', gender);
        if (hairStyle) formData.append('hairStyle', hairStyle);
        if (clothing) formData.append('clothing', clothing);
        if (accessories) formData.append('accessories', accessories);
        formData.append('photo', photo);
        
        const response = await fetch(`${API_URL}/people`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('addPersonResult', data, response.ok);
        
        if (response.ok) {
          // 폼 초기화
          document.getElementById('personName').value = '';
          document.getElementById('personGender').value = '';
          document.getElementById('personHairStyle').value = '';
          document.getElementById('personClothing').value = '';
          document.getElementById('personAccessories').value = '';
          document.getElementById('personPhoto').value = '';
        }
      } catch (err) {
        displayResult('addPersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('addPersonButton', false);
      }
    }
    
    async function getMyPeople() {
      try {
        setButtonLoading('getMyPeopleButton', true);
        
        if (!authToken) {
          displayResult('myPeopleResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('myPeopleResult', data, response.ok);
      } catch (err) {
        displayResult('myPeopleResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMyPeopleButton', false);
      }
    }
    
    async function searchPeople() {
      try {
        setButtonLoading('searchPeopleButton', true);
        
        if (!authToken) {
          displayResult('searchPeopleResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const keyword = document.getElementById('personSearchKeyword').value;
        if (!keyword) {
          displayResult('searchPeopleResult', { error: '검색어를 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people/search?keyword=${encodeURIComponent(keyword)}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('searchPeopleResult', data, response.ok);
      } catch (err) {
        displayResult('searchPeopleResult', { error: err.message }, false);
      } finally {
        setButtonLoading('searchPeopleButton', false);
      }
    }
    
    async function getPersonById() {
      try {
        setButtonLoading('getPersonButton', true);
        
        if (!authToken) {
          displayResult('getPersonResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('getPersonResult', { error: '인물 ID를 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('getPersonResult', data, response.ok);
        
        if (response.ok && data) {
          // 수정 폼에 기존 정보 채우기
          document.getElementById('updatePersonName').value = data.name || '';
          document.getElementById('updatePersonGender').value = data.gender || '';
          document.getElementById('updatePersonHairStyle').value = data.hairStyle || '';
          document.getElementById('updatePersonClothing').value = data.clothing || '';
          document.getElementById('updatePersonAccessories').value = data.accessories || '';
        }
      } catch (err) {
        displayResult('getPersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getPersonButton', false);
      }
    }
    
    async function updatePerson() {
      try {
        setButtonLoading('updatePersonButton', true);
        
        if (!authToken) {
          displayResult('updatePersonResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('updatePersonResult', { error: '인물 ID를 입력해주세요.' }, false);
          return;
        }
        
        const name = document.getElementById('updatePersonName').value;
        const gender = document.getElementById('updatePersonGender').value;
        const hairStyle = document.getElementById('updatePersonHairStyle').value;
        const clothing = document.getElementById('updatePersonClothing').value;
        const accessories = document.getElementById('updatePersonAccessories').value;
        const photo = document.getElementById('updatePersonPhoto').files[0];
        
        const formData = new FormData();
        if (name) formData.append('name', name);
        if (gender) formData.append('gender', gender);
        if (hairStyle) formData.append('hairStyle', hairStyle);
        if (clothing) formData.append('clothing', clothing);
        if (accessories) formData.append('accessories', accessories);
        if (photo) formData.append('photo', photo);
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updatePersonResult', data, response.ok);
      } catch (err) {
        displayResult('updatePersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updatePersonButton', false);
      }
    }
    
    async function deletePerson() {
      try {
        if (!authToken) {
          displayResult('updatePersonResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('updatePersonResult', { error: '인물 ID를 입력해주세요.' }, false);
          return;
        }
        
        if (!confirm('정말로 이 인물을 삭제하시겠습니까?')) {
          return;
        }
        
        setButtonLoading('deletePersonButton', true);
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('updatePersonResult', data, response.ok);
        
        if (response.ok) {
          // 폼 초기화
          document.getElementById('personId').value = '';
          document.getElementById('updatePersonName').value = '';
          document.getElementById('updatePersonGender').value = '';
          document.getElementById('updatePersonHairStyle').value = '';
          document.getElementById('updatePersonClothing').value = '';
          document.getElementById('updatePersonAccessories').value = '';
          document.getElementById('updatePersonPhoto').value = '';
        }
      } catch (err) {
        displayResult('updatePersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('deletePersonButton', false);
      }
    }
    
    // 일기 관리 함수들
    async function createDiary() {
      try {
        setButtonLoading('createDiaryButton', true);
        
        if (!authToken) {
          displayResult('createDiaryResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const content = document.getElementById('diaryContent').value;
        const diaryDate = document.getElementById('diaryDate').value;
        const artStyleId = document.getElementById('diaryArtStyle').value;
        const photos = document.getElementById('diaryPhotos').files;
        
        // 주인공 임시 정보
        const tempGender = document.getElementById('tempGender').value;
        const tempHairStyle = document.getElementById('tempHairStyle').value;
        const tempClothing = document.getElementById('tempClothing').value;
        const tempAccessories = document.getElementById('tempAccessories').value;
        
        if (!content || !artStyleId) {
          displayResult('createDiaryResult', { error: '일기 내용과 화풍은 필수입니다.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('content', content);
        formData.append('artStyleId', artStyleId);
        if (diaryDate) formData.append('diaryDate', diaryDate);
        
        // 주인공 임시 정보 추가
        const mainCharacter = {};
        if (tempGender) mainCharacter.gender = tempGender;
        if (tempHairStyle) mainCharacter.hairStyle = tempHairStyle;
        if (tempClothing) mainCharacter.clothing = tempClothing;
        if (tempAccessories) mainCharacter.accessories = tempAccessories;
        
        if (Object.keys(mainCharacter).length > 0) {
          formData.append('mainCharacter', JSON.stringify(mainCharacter));
        }
        
        for (let i = 0; i < photos.length; i++) {
          formData.append('photos', photos[i]);
        }
        
        const response = await fetch(`${API_URL}/diaries`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('createDiaryResult', data, response.ok);
        
        // 생성된 이미지 표시
        if (response.ok && data.diary && data.diary.generatedImage) {
          const imageContainer = document.getElementById('generatedDiaryImage');
          const img = document.createElement('img');
          img.src = data.diary.generatedImage.startsWith('http') ? data.diary.generatedImage : 
                   data.diary.generatedImage.startsWith('/') ? `http://localhost:5000${data.diary.generatedImage}` : 
                   `http://localhost:5000/${data.diary.generatedImage}`;
          img.alt = '생성된 일기 이미지';
          img.style.maxWidth = '100%';
          img.style.maxHeight = '400px';
          img.style.border = '1px solid #ddd';
          img.style.borderRadius = '5px';
          img.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
          
          imageContainer.innerHTML = '<h4>생성된 이미지:</h4>';
          imageContainer.appendChild(img);
        }
        
        if (response.ok) {
          // 폼 초기화
          document.getElementById('diaryContent').value = '';
          document.getElementById('diaryDate').value = '';
          document.getElementById('diaryArtStyle').value = '';
          document.getElementById('tempGender').value = '';
          document.getElementById('tempHairStyle').value = '';
          document.getElementById('tempClothing').value = '';
          document.getElementById('tempAccessories').value = '';
          document.getElementById('diaryPhotos').value = '';
        }
      } catch (err) {
        displayResult('createDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('createDiaryButton', false);
      }
    }
    
    async function getMyDiaries() {
      try {
        setButtonLoading('getMyDiariesButton', true);
        
        if (!authToken) {
          displayResult('myDiariesResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const page = document.getElementById('diaryPage').value || 1;
        const limit = document.getElementById('diaryLimit').value || 10;
        
        const response = await fetch(`${API_URL}/diaries?page=${page}&limit=${limit}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('myDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('myDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMyDiariesButton', false);
      }
    }
    
    async function getMonthlyDiaries() {
      try {
        setButtonLoading('getMonthlyDiariesButton', true);
        
        if (!authToken) {
          displayResult('monthlyDiariesResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const year = document.getElementById('monthlyYear').value;
        const month = document.getElementById('monthlyMonth').value;
        
        if (!year || !month) {
          displayResult('monthlyDiariesResult', { error: '년도와 월을 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/monthly?year=${year}&month=${month}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('monthlyDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('monthlyDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMonthlyDiariesButton', false);
      }
    }
    
    async function searchDiaries() {
      try {
        setButtonLoading('searchDiaryButton', true);
        
        if (!authToken) {
          displayResult('searchDiariesResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const keyword = document.getElementById('diarySearchKeyword').value;
        if (!keyword) {
          displayResult('searchDiariesResult', { error: '검색어를 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/search?keyword=${encodeURIComponent(keyword)}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('searchDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('searchDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('searchDiaryButton', false);
      }
    }
    
    async function getDiaryById() {
      try {
        setButtonLoading('getDiaryButton', true);
        
        if (!authToken) {
          displayResult('getDiaryResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('getDiaryResult', { error: '일기 ID를 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('getDiaryResult', data, response.ok);
        
        if (response.ok && data) {
          // 수정 폼에 기존 정보 채우기
          document.getElementById('updateDiaryContent').value = data.content || '';
        }
      } catch (err) {
        displayResult('getDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getDiaryButton', false);
      }
    }
    
    async function updateDiary() {
      try {
        setButtonLoading('updateDiaryButton', true);
        
        if (!authToken) {
          displayResult('updateDiaryResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('updateDiaryResult', { error: '일기 ID를 입력해주세요.' }, false);
          return;
        }
        
        const content = document.getElementById('updateDiaryContent').value;
        const photos = document.getElementById('updateDiaryPhotos').files;
        
        const formData = new FormData();
        if (content) formData.append('content', content);
        
        for (let i = 0; i < photos.length; i++) {
          formData.append('photos', photos[i]);
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updateDiaryResult', data, response.ok);
      } catch (err) {
        displayResult('updateDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateDiaryButton', false);
      }
    }
    
    async function deleteDiary() {
      try {
        if (!authToken) {
          displayResult('updateDiaryResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('updateDiaryResult', { error: '일기 ID를 입력해주세요.' }, false);
          return;
        }
        
        if (!confirm('정말로 이 일기를 삭제하시겠습니까?')) {
          return;
        }
        
        setButtonLoading('deleteDiaryButton', true);
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('updateDiaryResult', data, response.ok);
        
        if (response.ok) {
          // 폼 초기화
          document.getElementById('diaryId').value = '';
          document.getElementById('updateDiaryContent').value = '';
          document.getElementById('updateDiaryPhotos').value = '';
        }
      } catch (err) {
        displayResult('updateDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('deleteDiaryButton', false);
      }
    }
    
    async function getDiaryPromptLog() {
      try {
        setButtonLoading('getPromptLogButton', true);
        
        if (!authToken) {
          displayResult('promptLogResult', { error: '로그인이 필요합니다.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('promptLogResult', { error: '일기 ID를 입력해주세요.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}/prompt-log`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('promptLogResult', data, response.ok);
      } catch (err) {
        displayResult('promptLogResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getPromptLogButton', false);
      }
    }
    
    // 시스템 상태 관리 함수들
    async function pingServer() {
      try {
        setButtonLoading('pingServerButton', true);
        
        const response = await fetch(`${API_URL}/ping`);
        const data = await response.json();
        displayResult('pingServerResult', data, response.ok);
      } catch (err) {
        displayResult('pingServerResult', { error: err.message }, false);
      } finally {
        setButtonLoading('pingServerButton', false);
      }
    }
    
    async function testComfyUIConnection() {
      try {
        setButtonLoading('testComfyUIButton', true);
        
        const response = await fetch(`${API_URL}/test-comfyui`);
        const data = await response.json();
        displayResult('testComfyUIResult', data, response.ok);
      } catch (err) {
        displayResult('testComfyUIResult', { error: err.message }, false);
      } finally {
        setButtonLoading('testComfyUIButton', false);
      }
    }
    
    async function fullSystemCheck() {
      try {
        setButtonLoading('fullSystemCheckButton', true);
        
        const results = {
          timestamp: new Date().toISOString(),
          checks: {}
        };
        
        // 서버 상태 확인
        try {
          const pingResponse = await fetch(`${API_URL}/ping`);
          const pingData = await pingResponse.json();
          results.checks.server = {
            status: pingResponse.ok ? 'OK' : 'FAIL',
            response: pingData,
            responseTime: 'N/A'
          };
        } catch (err) {
          results.checks.server = {
            status: 'FAIL',
            error: err.message
          };
        }
        
        // ComfyUI 상태 확인
        try {
          const comfyResponse = await fetch(`${API_URL}/test-comfyui`);
          const comfyData = await comfyResponse.json();
          results.checks.comfyui = {
            status: comfyResponse.ok ? 'OK' : 'FAIL',
            response: comfyData
          };
        } catch (err) {
          results.checks.comfyui = {
            status: 'FAIL',
            error: err.message
          };
        }
        
        // 인증 상태 확인
        if (authToken) {
          try {
            const authResponse = await fetch(`${API_URL}/users/profile`, {
              headers: { 'Authorization': `Bearer ${authToken}` }
            });
            results.checks.authentication = {
              status: authResponse.ok ? 'OK' : 'FAIL',
              hasToken: true,
              tokenValid: authResponse.ok
            };
          } catch (err) {
            results.checks.authentication = {
              status: 'FAIL',
              hasToken: true,
              tokenValid: false,
              error: err.message
            };
          }
        } else {
          results.checks.authentication = {
            status: 'NO_TOKEN',
            hasToken: false,
            message: '토큰이 없습니다. 로그인이 필요합니다.'
          };
        }
        
        displayResult('fullSystemCheckResult', results, true);
      } catch (err) {
        displayResult('fullSystemCheckResult', { error: err.message }, false);
      } finally {
        setButtonLoading('fullSystemCheckButton', false);
      }
    }
    
    function checkTokenStatus() {
      const tokenStatusText = document.getElementById('tokenStatusText');
      
      if (authToken) {
        try {
          // JWT 토큰 디코딩 (간단한 방법)
          const payload = JSON.parse(atob(authToken.split('.')[1]));
          const now = Math.floor(Date.now() / 1000);
          const isExpired = payload.exp < now;
          
          tokenStatusText.innerHTML = `
            <span style="color: ${isExpired ? '#dc3545' : '#28a745'};">
              ${isExpired ? '만료됨' : '유효함'}
            </span>
            <br><small>만료 시간: ${new Date(payload.exp * 1000).toLocaleString()}</small>
          `;
        } catch (err) {
          tokenStatusText.innerHTML = '<span style="color: #dc3545;">토큰 형식 오류</span>';
        }
      } else {
        tokenStatusText.innerHTML = '<span style="color: #6c757d;">토큰 없음</span>';
      }
    }
    
    function clearToken() {
      if (confirm('저장된 토큰을 삭제하시겠습니까? 로그아웃됩니다.')) {
        localStorage.removeItem('authToken');
        authToken = null;
        checkTokenStatus();
        alert('토큰이 삭제되었습니다.');
      }
    }
    

  </script>
</body>
</html> 