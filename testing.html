<!DOCTYPE html>
<html>
<head>
  <title>ì¼ê¸° ì•± ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸ (v3.0)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .section {
      background: white;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .section-header {
      background-color: #f8f9fa;
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-content {
      padding: 20px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #495057;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #dee2e6;
      background-color: #f8f9fa;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .tab {
      display: flex;
      background-color: #e9ecef;
      border-radius: 8px 8px 0 0;
      overflow: hidden;
    }
    
    .tab button {
      background-color: transparent;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 15px 20px;
      transition: 0.3s;
      color: #495057;
      font-weight: 600;
      margin: 0;
      border-radius: 0;
    }
    
    .tab button:hover {
      background-color: #dee2e6;
      transform: none;
      box-shadow: none;
    }
    
    .tab button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .tabcontent {
      display: none;
      padding: 0;
    }
    
    .tabcontent.show {
      display: block;
    }
    
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-online { background-color: #28a745; }
    .status-offline { background-color: #dc3545; }
    .status-unknown { background-color: #6c757d; }
    
    .required {
      color: #dc3545;
    }
    
    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    
    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }

    .v3-highlight {
      background-color: #e8f5e8;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      border: 1px solid #c3e6cb;
    }

    .v3-highlight h4 {
      margin-top: 0;
      color: #155724;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ì¼ê¸° ì•± ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸</h1>
    <p>v3.0.1 - ê°„ì†Œí™”ëœ ì›Œí¬í”Œë¡œìš° & ë™ê¸°ì  ì´ë¯¸ì§€ ìƒì„±</p>
    <div id="connectionStatus">
      <span class="status-indicator status-unknown"></span>
      ì„œë²„ ì—°ê²° ìƒíƒœ: í™•ì¸ ì¤‘...
    </div>
  </div>

  <div class="section">
    <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'userSection')">ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬</button>
      <button class="tablinks" onclick="openTab(event, 'peopleSection')">ğŸ‘¥ ì¸ë¬¼ ê´€ë¦¬</button>
      <button class="tablinks" onclick="openTab(event, 'diarySection')">ğŸ“” ì¼ê¸° ê´€ë¦¬</button>
      <button class="tablinks" onclick="openTab(event, 'systemSection')">ğŸ› ï¸ ì‹œìŠ¤í…œ ìƒíƒœ</button>
    </div>

    <div id="userSection" class="tabcontent show">
      <!-- íšŒì›ê°€ì… -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ‘¤ íšŒì›ê°€ì…</h3>
          <code>POST /api/users/register</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="registerUsername">ì‚¬ìš©ì ì´ë¦„ <span class="required">*</span></label>
                <input type="text" id="registerUsername" placeholder="ì‚¬ìš©ì ì´ë¦„">
              </div>
              <div class="form-group">
                <label for="registerEmail">ì´ë©”ì¼ <span class="required">*</span></label>
                <input type="email" id="registerEmail" placeholder="user@example.com">
              </div>
              <div class="form-group">
                <label for="registerPassword">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="password" id="registerPassword" placeholder="ìµœì†Œ 6ì">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="registerGender">ì„±ë³„ <span class="required">*</span></label>
                <select id="registerGender">
                  <option value="">ì„±ë³„ ì„ íƒ</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
              </div>
              <div class="form-group">
                <label for="registerProfilePhoto">í”„ë¡œí•„ ì‚¬ì§„</label>
                <input type="file" id="registerProfilePhoto" accept="image/*">
              </div>
            </div>
          </div>
          <button id="registerButton" onclick="registerUser()">íšŒì›ê°€ì…</button>
          <div id="registerResult" class="result"></div>
        </div>
      </div>

      <!-- ë¡œê·¸ì¸ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ”‘ ë¡œê·¸ì¸</h3>
          <code>POST /api/users/login</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="loginEmail">ì´ë©”ì¼ <span class="required">*</span></label>
                <input type="email" id="loginEmail" placeholder="user@example.com">
              </div>
              <div class="form-group">
                <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
              </div>
            </div>
          </div>
          <button id="loginButton" onclick="loginUser()">ë¡œê·¸ì¸</button>
          <div id="loginResult" class="result"></div>
        </div>
      </div>

      <!-- í”„ë¡œí•„ ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ‘¤ í”„ë¡œí•„ ì¡°íšŒ</h3>
          <code>GET /api/users/profile</code>
        </div>
        <div class="section-content">
          <button id="getProfileButton" onclick="getUserProfile()">ë‚´ í”„ë¡œí•„ ì¡°íšŒ</button>
          <div id="profileResult" class="result"></div>
        </div>
      </div>

      <!-- í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“· í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸</h3>
          <code>PUT /api/users/profile/photo</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="updateProfilePhoto">ìƒˆ í”„ë¡œí•„ ì‚¬ì§„ <span class="required">*</span></label>
            <input type="file" id="updateProfilePhoto" accept="image/*">
          </div>
          <button id="updateProfileButton" onclick="updateUserProfilePhoto()">í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸</button>
          <div id="updateProfileResult" class="result"></div>
        </div>
      </div>

      <!-- í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • -->
      <div class="section">
        <div class="section-header">
          <h3>âœï¸ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •</h3>
          <code>PUT /api/users/profile</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="updateUsername">ìƒˆ ì‚¬ìš©ì ì´ë¦„</label>
                <input type="text" id="updateUsername" placeholder="ìƒˆ ì‚¬ìš©ì ì´ë¦„ (ì„ íƒ)">
              </div>
              <div class="form-group">
                <label for="updateEmail">ìƒˆ ì´ë©”ì¼</label>
                <input type="email" id="updateEmail" placeholder="ìƒˆ ì´ë©”ì¼ (ì„ íƒ)">
              </div>
            </div>
          </div>
          <button id="updateUserInfoButton" onclick="updateUserInfo()">í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •</button>
          <div id="updateUserInfoResult" class="result"></div>
        </div>
      </div>

      <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
          <code>PUT /api/users/profile/password</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="password" id="currentPassword" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
              </div>
              <div class="form-group">
                <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)">
              </div>
            </div>
          </div>
          <button id="changePasswordButton" onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
          <div id="changePasswordResult" class="result"></div>
        </div>
      </div>
    </div>

    <!-- ë‹¤ë¥¸ ì„¹ì…˜ë“¤ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¶”ê°€ -->
    <div id="peopleSection" class="tabcontent">
      <!-- ìƒˆ ì¸ë¬¼ ì¶”ê°€ -->
      <div class="section">
        <div class="section-header">
          <h3>â• ìƒˆ ì¸ë¬¼ ì¶”ê°€</h3>
          <code>POST /api/people</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="personName">ì´ë¦„ <span class="required">*</span></label>
                <input type="text" id="personName" placeholder="ì¸ë¬¼ ì´ë¦„">
              </div>
              <div class="form-group">
                <label for="personGender">ì„±ë³„</label>
                <select id="personGender">
                  <option value="">ì„ íƒ ì•ˆí•¨</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
              </div>
              <div class="form-group">
                <label for="personPhoto">ì‚¬ì§„ <span class="required">*</span></label>
                <input type="file" id="personPhoto" accept="image/*">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="personNote">ë©”ëª¨ (ì„ íƒ)</label>
                <textarea id="personNote" rows="3" placeholder="ì¸ë¬¼ì— ëŒ€í•œ ì¶”ê°€ ë©”ëª¨ (v2.1ì—ì„œëŠ” ì„±ë³„ë§Œ ì €ì¥ë©ë‹ˆë‹¤)"></textarea>
              </div>
              <div style="background-color: #fff3cd; padding: 10px; border-radius: 5px; border: 1px solid #ffeaa7;">
                <small><strong>v2.1 ë³€ê²½ì‚¬í•­:</strong> í—¤ì–´ìŠ¤íƒ€ì¼, ì˜ìƒ, ì•…ì„¸ì‚¬ë¦¬ í•„ë“œëŠ” ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ì„±ë³„ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</small>
              </div>
            </div>
          </div>
          <button id="addPersonButton" onclick="addPerson()">ì¸ë¬¼ ì¶”ê°€</button>
          <div id="addPersonResult" class="result"></div>
        </div>
      </div>

      <!-- ì¸ë¬¼ ëª©ë¡ ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“‹ ë‚´ ì¸ë¬¼ ëª©ë¡</h3>
          <code>GET /api/people</code>
        </div>
        <div class="section-content">
          <button id="getMyPeopleButton" onclick="getMyPeople()">ì¸ë¬¼ ëª©ë¡ ì¡°íšŒ</button>
          <div id="myPeopleResult" class="result"></div>
        </div>
      </div>

      <!-- ì¸ë¬¼ ê²€ìƒ‰ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ” ì¸ë¬¼ ê²€ìƒ‰</h3>
          <code>GET /api/people/search</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="personSearchKeyword">ê²€ìƒ‰ì–´</label>
            <input type="text" id="personSearchKeyword" placeholder="ì¸ë¬¼ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰">
          </div>
          <button id="searchPeopleButton" onclick="searchPeople()">ì¸ë¬¼ ê²€ìƒ‰</button>
          <div id="searchPeopleResult" class="result"></div>
        </div>
      </div>

      <!-- íŠ¹ì • ì¸ë¬¼ ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ -->
      <div class="section">
        <div class="section-header">
          <h3>âœï¸ ì¸ë¬¼ ê´€ë¦¬</h3>
          <code>GET/PUT/DELETE /api/people/{id}</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="personId">ì¸ë¬¼ ID <span class="required">*</span></label>
            <input type="text" id="personId" placeholder="ì¸ë¬¼ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          
          <button id="getPersonButton" onclick="getPersonById()">ì¸ë¬¼ ì¡°íšŒ</button>
          <div id="getPersonResult" class="result"></div>
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid #dee2e6;">
          
          <h4>ì¸ë¬¼ ì •ë³´ ìˆ˜ì •</h4>
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="updatePersonName">ì´ë¦„</label>
                <input type="text" id="updatePersonName" placeholder="ìˆ˜ì •í•  ì´ë¦„">
              </div>
              <div class="form-group">
                <label for="updatePersonGender">ì„±ë³„</label>
                <select id="updatePersonGender">
                  <option value="">ë³€ê²½ ì•ˆí•¨</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
              </div>
              <div class="form-group">
                <label for="updatePersonPhoto">ìƒˆ ì‚¬ì§„</label>
                <input type="file" id="updatePersonPhoto" accept="image/*">
              </div>
            </div>
            <div>
              <div style="background-color: #fff3cd; padding: 10px; border-radius: 5px; border: 1px solid #ffeaa7;">
                <small><strong>v2.1 ë³€ê²½ì‚¬í•­:</strong> í—¤ì–´ìŠ¤íƒ€ì¼, ì˜ìƒ, ì•…ì„¸ì‚¬ë¦¬ í•„ë“œëŠ” ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</small>
              </div>
            </div>
          </div>
          
          <button id="updatePersonButton" onclick="updatePerson()">ì¸ë¬¼ ì •ë³´ ìˆ˜ì •</button>
          <button id="deletePersonButton" onclick="deletePerson()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">ì¸ë¬¼ ì‚­ì œ</button>
          
          <div id="updatePersonResult" class="result"></div>
        </div>
      </div>
    </div>

    <div id="diarySection" class="tabcontent">
      <!-- í™”í’ ëª©ë¡ ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ¨ í™”í’ ëª©ë¡ ì¡°íšŒ</h3>
          <code>GET /api/diaries/art-styles</code>
        </div>
        <div class="section-content">
          <p>ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™”í’ ìŠ¤íƒ€ì¼ê³¼ í•„ìˆ˜ í‚¤ì›Œë“œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
          <button id="getArtStylesButton" onclick="getArtStyles()">í™”í’ ëª©ë¡ ì¡°íšŒ</button>
          <div id="artStylesResult" class="result"></div>
        </div>
      </div>

      <!-- ì¥ë©´ ë¬˜ì‚¬ ìƒì„± (v3.0 ì—…ë°ì´íŠ¸) -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ–¼ï¸ ì¥ë©´ ë¬˜ì‚¬ ìƒì„± (v3.0)</h3>
          <code>POST /api/diaries/generate-scene</code>
        </div>
        <div class="section-content">
          <div class="v3-highlight">
            <h4>v3.0 í…ŒìŠ¤íŠ¸ìš© ì¥ë©´ ë¬˜ì‚¬ ìƒì„±</h4>
            <p><strong>ì•ˆë‚´:</strong> ì¼ë°˜ì ìœ¼ë¡œëŠ” ì•„ë˜ "ì¼ê¸° ì‘ì„±" ì„¹ì…˜ì—ì„œ í†µí•© ì›Œí¬í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ì´ ì„¹ì…˜ì€ ì¥ë©´ ë¬˜ì‚¬ ê¸°ëŠ¥ë§Œ ë³„ë„ë¡œ í…ŒìŠ¤íŠ¸í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
            <ul>
              <li><strong>JSON êµ¬ì¡°í™”ëœ ì‘ë‹µ:</strong> {TEXT: "ì¥ë©´ë¬˜ì‚¬", PERSON: "ì£¼ì¸ê³µì´ë¦„"}</li>
              <li><strong>ìŠ¤ë§ˆíŠ¸ íƒœê·¸ ì‹œìŠ¤í…œ:</strong> @íƒœê·¸ ìë™ ì¸ì‹ ë° ì²˜ë¦¬</li>
              <li><strong>ê°„ì†Œí™”ëœ ì…ë ¥:</strong> ì¼ê¸° ë‚´ìš©ë§Œìœ¼ë¡œ ëª¨ë“  ì •ë³´ ì¶”ì¶œ</li>
            </ul>
          </div>
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="sceneContent">í…ŒìŠ¤íŠ¸ìš© ì¼ê¸° ë‚´ìš© (@íƒœê·¸ ì§€ì›) <span class="required">*</span></label>
                <textarea id="sceneContent" rows="4" placeholder="@ê¹€ì² ìˆ˜ì™€ ì¹´í˜ì—ì„œ ë§Œë‚¬ë‹¤. ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ë‹¤.&#10;@ì—„ë§ˆì™€ í•¨ê»˜ ì‡¼í•‘ì„ ê°”ë‹¤.&#10;ì¹œêµ¬ë“¤ê³¼ ê³µì›ì—ì„œ ë†€ì•˜ë‹¤."></textarea>
              </div>
            </div>
            <div>
              <div style="background-color: #fff3cd; padding: 15px; border-radius: 6px; border: 1px solid #ffeaa7;">
                <h4 style="margin-top: 0;">v3.0 ë³€ê²½ì‚¬í•­</h4>
                <ul style="margin-bottom: 0; padding-left: 20px;">
                  <li>protagonistName, sceneDirectionHint í•„ë“œ ì œê±°</li>
                  <li>@íƒœê·¸ë¡œ ì£¼ì¸ê³µ ìë™ ì‹ë³„</li>
                  <li>JSON ì‘ë‹µìœ¼ë¡œ êµ¬ì¡°í™”ëœ ë°ì´í„° ì œê³µ</li>
                </ul>
              </div>
              </div>
            </div>
          <button id="generateSceneButton" onclick="generateSceneDescription()">í…ŒìŠ¤íŠ¸ìš© JSON ì¥ë©´ ë¬˜ì‚¬ ìƒì„±</button>
          <div id="sceneGenerationResult" class="result"></div>
        </div>
      </div>

      <!-- ì¼ê¸° ì‘ì„± - ê°„ì†Œí™”ëœ ë°©ì‹ (v3.0.1 ì—…ë°ì´íŠ¸) -->
      <div class="section">
        <div class="section-header">
          <h3>âœï¸ ì¼ê¸° ì‘ì„± - ê°„ì†Œí™”ëœ ë°©ì‹ (v3.0.1)</h3>
          <code>POST /api/diaries - ê°„ì†Œí™”ëœ ì›Œí¬í”Œë¡œìš°</code>
        </div>
        <div class="section-content">
          <div class="v3-highlight">
            <h4>v3.0.1 ê°„ì†Œí™”ëœ ì›Œí¬í”Œë¡œìš°</h4>
            <p><strong>í”„ë¡ íŠ¸ì—”ë“œ ìš”ì²­ ë°©ì‹:</strong> selectedPersonId ì—†ì´ë„ ì´ë¯¸ì§€ ìƒì„± ê°€ëŠ¥</p>
            <ol>
              <li>ì¼ê¸° ë‚´ìš© ì…ë ¥ (@íƒœê·¸ ì§€ì›)</li>
              <li>ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±</li>
              <li>ì™¸ëª¨ í‚¤ì›Œë“œ + ì„±ë³„ ì…ë ¥ (ì¸ë¬¼ ì„ íƒ ì—†ì´)</li>
              <li>ë™ê¸°ì  ì´ë¯¸ì§€ ìƒì„± (ì™„ë£Œ í›„ ì‘ë‹µ)</li>
            </ol>
            <p><strong>íŠ¹ì§•:</strong> ê¸°ì¡´ ì¸ë¬¼ DB ì—†ì´ë„ ë°”ë¡œ ì´ë¯¸ì§€ ìƒì„± ê°€ëŠ¥</p>
          </div>
          
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="simpleDiaryContent">1ë‹¨ê³„: ì¼ê¸° ë‚´ìš© (@íƒœê·¸ ì§€ì›) <span class="required">*</span></label>
                <textarea id="simpleDiaryContent" rows="4" placeholder="@ì¹œêµ¬ì™€ ì¹´í˜ì—ì„œ ì»¤í”¼ë¥¼ ë§ˆì…¨ë‹¤. ì •ë§ ì¦ê±°ìš´ ì‹œê°„ì´ì—ˆë‹¤.&#10;&#10;@íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ì£¼ì¸ê³µì„ ì‹ë³„í•©ë‹ˆë‹¤."></textarea>
                <button type="button" onclick="generateSceneFromSimpleDiary()" style="margin-top: 5px; padding: 8px 12px; font-size: 12px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±</button>
              </div>
              
              <div class="form-group">
                <label for="simpleSceneDescription">2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ (ìë™ ìƒì„±ë¨)</label>
                <textarea id="simpleSceneDescription" rows="3" placeholder="ìœ„ì˜ 'ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒì„±í•˜ì„¸ìš”" readonly style="background-color: #f8f9fa;"></textarea>
              </div>
              
              <div class="form-group">
                <label for="simpleMainCharacterGender">3ë‹¨ê³„: ì£¼ì¸ê³µ ì„±ë³„ <span class="required">*</span></label>
                <select id="simpleMainCharacterGender">
                  <option value="">ì„±ë³„ ì„ íƒ</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="simpleUserAppearanceKeywords">3ë‹¨ê³„: ì™¸ëª¨ í‚¤ì›Œë“œ <span class="required">*</span></label>
                <input type="text" id="simpleUserAppearanceKeywords" placeholder="ì˜ˆ: long hair, casual clothing, glasses">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="simpleDiaryDate">ì¼ê¸° ë‚ ì§œ</label>
                <input type="date" id="simpleDiaryDate">
              </div>
              
              <div class="form-group">
                <label for="simpleDiaryArtStyle">í™”í’ ì„ íƒ <span class="required">*</span></label>
                <select id="simpleDiaryArtStyle">
                  <option value="">í™”í’ ì„ íƒ</option>
                  <option value="makoto_shinkai">ì‹ ì¹´ì´ ë§ˆì½”í†  (Makoto Shinkai)</option>
                  <option value="esthetic_80s">ì—ìŠ¤í…Œí‹± 80ë…„ëŒ€ (Esthetic 80s)</option>
                  <option value="3d_character">3D ìºë¦­í„° (3D Character - Chibi)</option>
                  <option value="minimalist_line">ë¯¸ë‹ˆë©€ ë¼ì¸ (Minimalist Line)</option>
                  <option value="disney_pixar">ë””ì¦ˆë‹ˆ í”½ì‚¬ (Disney Pixar)</option>
                  <option value="animal_crossing">ë™ë¬¼ì˜ ìˆ² (Animal Crossing)</option>
                  <option value="rhythm_heaven">ë¦¬ë“¬ í—¤ë¸ (Rhythm Heaven)</option>
                  <option value="studio_ghibli">ìŠ¤íŠœë””ì˜¤ ì§€ë¸Œë¦¬ (Studio Ghibli)</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="simpleDiaryPhotos">ì‚¬ì§„ (ìµœëŒ€ 5ê°œ)</label>
                <input type="file" id="simpleDiaryPhotos" accept="image/*" multiple>
              </div>
              
              <div style="background-color: #e8f4fd; padding: 15px; border-radius: 5px; margin-top: 10px; border: 1px solid #b8daff;">
                <h4 style="margin-top: 0; color: #004085;">v3.0.1 ê°„ì†Œí™”ëœ ì›Œí¬í”Œë¡œìš°</h4>
                <ul style="margin-bottom: 0; padding-left: 20px;">
                  <li>ê¸°ì¡´ ì¸ë¬¼ DB ì—°ë™ ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥</li>
                  <li>í”„ë¡ íŠ¸ì—”ë“œ ìš”ì²­ ë°ì´í„°ë§Œìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±</li>
                  <li>ë™ê¸°ì  ì²˜ë¦¬ë¡œ ì™„ì„±ëœ ì´ë¯¸ì§€ì™€ í•¨ê»˜ ì‘ë‹µ</li>
                  <li>selectedPersonId í•„ë“œ ë¶ˆí•„ìš”</li>
                </ul>
              </div>
            </div>
          </div>
          <button id="createSimpleDiaryButton" onclick="createSimpleDiary()" style="padding: 15px 25px; font-size: 16px; font-weight: bold; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">4ë‹¨ê³„: ê°„ì†Œí™”ëœ ì¼ê¸° ì‘ì„± (ì´ë¯¸ì§€ ìƒì„±)</button>
          <div id="createSimpleDiaryResult" class="result"></div>
          <div id="generatedSimpleDiaryImage" style="margin-top: 15px;"></div>
        </div>
      </div>

      <!-- ì¼ê¸° ì‘ì„± (v3.0 ì—…ë°ì´íŠ¸) -->
      <div class="section">
        <div class="section-header">
          <h3>âœï¸ ì¼ê¸° ì‘ì„± - ê¸°ì¡´ ë°©ì‹ (v3.0)</h3>
          <code>POST /api/diaries</code>
        </div>
        <div class="section-content">
          <div class="v3-highlight">
            <h4>v3.0 ì •í™•í•œ 6ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°</h4>
            <ol>
              <li>ì¼ê¸° ì‘ì„± (@íƒœê·¸ ì§€ì›)</li>
              <li>ì¥ë©´ ë¬˜ì‚¬ ìƒì„± (JSON ì‘ë‹µ, @íƒœê·¸ ê¸°ë°˜)</li>
              <li><strong>ì£¼ìš” ì¸ë¬¼ ì„ íƒ</strong> (ê¸°ì¡´ ì¸ë¬¼ ëª©ë¡ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒ)</li>
              <li>ì£¼ìš” ì¸ë¬¼ ì™¸í˜• ì‘ì„± (ì„ íƒëœ ì¸ë¬¼ì˜ ì„±ë³„ ì •ë³´ ìë™ ì‚¬ìš©)</li>
              <li>í”„ë¡¬í”„íŠ¸ ìƒì„± (ì¥ë©´ ë¬˜ì‚¬ 100% í™œìš©)</li>
              <li>ì´ë¯¸ì§€ ìƒì„±</li>
            </ol>
          </div>
          <div class="v3-highlight">
            <h4>v3.0 í†µí•© ì›Œí¬í”Œë¡œìš°</h4>
            <p><strong>ë‹¨ê³„:</strong> 1) ì¼ê¸° ì‘ì„± â†’ 2) ì¥ë©´ ë¬˜ì‚¬ ìƒì„± â†’ 3) ì£¼ìš” ì¸ë¬¼ ì„ íƒ â†’ 4) ì™¸ëª¨ í‚¤ì›Œë“œ ì…ë ¥ â†’ 5) ì´ë¯¸ì§€ ìƒì„±</p>
          </div>
          
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="diaryContent">1ë‹¨ê³„: ì¼ê¸° ë‚´ìš© (@íƒœê·¸ ì§€ì›) <span class="required">*</span></label>
                <textarea id="diaryContent" rows="4" placeholder="@ì¹œêµ¬ì™€ ì¹´í˜ì—ì„œ ì»¤í”¼ë¥¼ ë§ˆì…¨ë‹¤. ì •ë§ ì¦ê±°ìš´ ì‹œê°„ì´ì—ˆë‹¤.&#10;&#10;@íƒœê·¸ëŠ” ì¥ë©´ ë¬˜ì‚¬ ìƒì„±ì„ ìœ„í•œ íŒíŠ¸ì…ë‹ˆë‹¤."></textarea>
                <button type="button" onclick="generateSceneFromDiary()" style="margin-top: 5px; padding: 8px 12px; font-size: 12px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±</button>
              </div>
              
              <div class="form-group">
                <label for="sceneDescription">2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ (ìë™ ìƒì„±ë¨)</label>
                <textarea id="sceneDescription" rows="3" placeholder="ìœ„ì˜ 'ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒì„±í•˜ì„¸ìš”" readonly style="background-color: #f8f9fa;"></textarea>
              </div>
              
              <div class="form-group">
                <label for="selectedMainCharacter">3ë‹¨ê³„: ì£¼ìš” ì¸ë¬¼ ì„ íƒ <span class="required">*</span></label>
                <select id="selectedMainCharacter">
                  <option value="">ì¸ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
                <button type="button" onclick="loadMyPeopleForSelectionWithFeedback()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">ì¸ë¬¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
              </div>
              
              <div class="form-group">
                <label for="userAppearanceKeywords">4ë‹¨ê³„: ì‚¬ìš©ì ì™¸ëª¨ í‚¤ì›Œë“œ <span class="required">*</span></label>
                <input type="text" id="userAppearanceKeywords" placeholder="ì˜ˆ: long hair, casual clothing, glasses (ì„±ë³„ ì œì™¸)">
              </div>
            </div>
            <div>
              <div class="form-group">
                <label for="diaryDate">ì¼ê¸° ë‚ ì§œ</label>
                <input type="date" id="diaryDate">
              </div>
              
              <div class="form-group">
                <label for="diaryArtStyle">í™”í’ ì„ íƒ <span class="required">*</span></label>
                <select id="diaryArtStyle">
                  <option value="">í™”í’ ì„ íƒ</option>
                  <option value="makoto_shinkai">ì‹ ì¹´ì´ ë§ˆì½”í†  (Makoto Shinkai)</option>
                  <option value="esthetic_80s">ì—ìŠ¤í…Œí‹± 80ë…„ëŒ€ (Esthetic 80s)</option>
                  <option value="3d_character">3D ìºë¦­í„° (3D Character - Chibi)</option>
                  <option value="minimalist_line">ë¯¸ë‹ˆë©€ ë¼ì¸ (Minimalist Line)</option>
                  <option value="disney_pixar">ë””ì¦ˆë‹ˆ í”½ì‚¬ (Disney Pixar)</option>
                  <option value="animal_crossing">ë™ë¬¼ì˜ ìˆ² (Animal Crossing)</option>
                  <option value="rhythm_heaven">ë¦¬ë“¬ í—¤ë¸ (Rhythm Heaven)</option>
                  <option value="studio_ghibli">ìŠ¤íŠœë””ì˜¤ ì§€ë¸Œë¦¬ (Studio Ghibli)</option>
                </select>
                <button type="button" onclick="loadArtStyles()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">í™”í’ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
              </div>
              
              <div class="form-group">
                <label for="diaryPhotos">ì‚¬ì§„ (ìµœëŒ€ 5ê°œ)</label>
                <input type="file" id="diaryPhotos" accept="image/*" multiple>
              </div>
              
              <div style="background-color: #e3f2fd; padding: 15px; border-radius: 5px; margin-top: 10px; border: 1px solid #90caf9;">
                <h4 style="margin-top: 0; color: #1976d2;">v3.0 ì›Œí¬í”Œë¡œìš° ì•ˆë‚´</h4>
                <ol style="margin-bottom: 0; padding-left: 20px;">
                  <li>ì¼ê¸° ë‚´ìš©ì— @íƒœê·¸ í¬í•¨í•˜ì—¬ ì‘ì„±</li>
                  <li>"ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±" ë²„íŠ¼ í´ë¦­</li>
                  <li>ê¸°ì¡´ ì¸ë¬¼ ëª©ë¡ì—ì„œ ì£¼ìš” ì¸ë¬¼ ì„ íƒ</li>
                  <li>ì™¸ëª¨ í‚¤ì›Œë“œ ì…ë ¥ í›„ ì¼ê¸° ì‘ì„± ì™„ë£Œ</li>
                </ol>
                </div>
                </div>
                </div>
          <button id="createDiaryButton" onclick="createDiary()" style="padding: 15px 25px; font-size: 16px; font-weight: bold;">5ë‹¨ê³„: ì¼ê¸° ì‘ì„± ì™„ë£Œ (ì´ë¯¸ì§€ ìƒì„±)</button>
          <div id="createDiaryResult" class="result"></div>
          <div id="generatedDiaryImage" style="margin-top: 15px;"></div>
        </div>
      </div>

      <!-- ì¼ê¸° ëª©ë¡ ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“‹ ì¼ê¸° ëª©ë¡ ì¡°íšŒ</h3>
          <code>GET /api/diaries</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="diaryPage">í˜ì´ì§€</label>
                <input type="number" id="diaryPage" value="1" min="1" placeholder="í˜ì´ì§€ ë²ˆí˜¸">
              </div>
              <div class="form-group">
                <label for="diaryLimit">í˜ì´ì§€ë‹¹ ê°œìˆ˜</label>
                <input type="number" id="diaryLimit" value="10" min="1" max="50" placeholder="10">
              </div>
            </div>
          </div>
          <button id="getMyDiariesButton" onclick="getMyDiaries()">ë‚´ ì¼ê¸° ëª©ë¡ ì¡°íšŒ</button>
          <div id="myDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- ì›”ë³„ ì¼ê¸° ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“… ì›”ë³„ ì¼ê¸° ì¡°íšŒ</h3>
          <code>GET /api/diaries/monthly</code>
        </div>
        <div class="section-content">
          <div class="form-grid">
            <div>
              <div class="form-group">
                <label for="monthlyYear">ë…„ë„ <span class="required">*</span></label>
                <input type="number" id="monthlyYear" value="2025" min="2000" max="2030" placeholder="2025">
              </div>
              <div class="form-group">
                <label for="monthlyMonth">ì›” <span class="required">*</span></label>
                <input type="number" id="monthlyMonth" value="1" min="1" max="12" placeholder="1">
              </div>
            </div>
          </div>
          <button id="getMonthlyDiariesButton" onclick="getMonthlyDiaries()">ì›”ë³„ ì¼ê¸° ì¡°íšŒ</button>
          <div id="monthlyDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- ì¼ê¸° ê²€ìƒ‰ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ” ì¼ê¸° ê²€ìƒ‰</h3>
          <code>GET /api/diaries/search</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="diarySearchKeyword">ê²€ìƒ‰ì–´</label>
            <input type="text" id="diarySearchKeyword" placeholder="ì¼ê¸° ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰">
          </div>
          <button id="searchDiaryButton" onclick="searchDiaries()">ì¼ê¸° ê²€ìƒ‰</button>
          <div id="searchDiariesResult" class="result"></div>
        </div>
      </div>

      <!-- íŠ¹ì • ì¼ê¸° ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ -->
      <div class="section">
        <div class="section-header">
          <h3>âœï¸ ì¼ê¸° ê´€ë¦¬</h3>
          <code>GET/PUT/DELETE /api/diaries/{id}</code>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label for="diaryId">ì¼ê¸° ID <span class="required">*</span></label>
            <input type="text" id="diaryId" placeholder="ì¼ê¸° IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          
          <button id="getDiaryButton" onclick="getDiaryById()">ì¼ê¸° ì¡°íšŒ</button>
          <div id="getDiaryResult" class="result"></div>
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid #dee2e6;">
          
          <h4>ì¼ê¸° ìˆ˜ì •</h4>
          <div class="form-group">
            <label for="updateDiaryContent">ë‚´ìš©</label>
            <textarea id="updateDiaryContent" rows="5" placeholder="ìˆ˜ì •í•  ë‚´ìš©"></textarea>
          </div>
          <div class="form-group">
            <label for="updateDiaryPhotos">ì¶”ê°€ ì‚¬ì§„</label>
            <input type="file" id="updateDiaryPhotos" accept="image/*" multiple>
          </div>
          
          <button id="updateDiaryButton" onclick="updateDiary()">ì¼ê¸° ìˆ˜ì •</button>
          <button id="deleteDiaryButton" onclick="deleteDiary()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">ì¼ê¸° ì‚­ì œ</button>
          
          <div id="updateDiaryResult" class="result"></div>
        </div>
      </div>

      <!-- í”„ë¡¬í”„íŠ¸ ë¡œê·¸ ì¡°íšŒ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“ í”„ë¡¬í”„íŠ¸ ë¡œê·¸ ì¡°íšŒ</h3>
          <code>GET /api/diaries/{id}/prompt-log</code>
        </div>
        <div class="section-content">
          <p>ì¼ê¸° ì‘ì„± ì‹œ ìë™ ìƒì„±ëœ ì´ë¯¸ì§€ì˜ í”„ë¡¬í”„íŠ¸ ë¡œê·¸ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ìœ„ì˜ ì¼ê¸° IDë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</p>
          <button id="getPromptLogButton" onclick="getDiaryPromptLog()">í”„ë¡¬í”„íŠ¸ ë¡œê·¸ ì¡°íšŒ</button>
          <div id="promptLogResult" class="result"></div>
        </div>
      </div>
    </div>

    <div id="systemSection" class="tabcontent">
      <!-- ì„œë²„ ìƒíƒœ í™•ì¸ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ”— ì„œë²„ ìƒíƒœ í™•ì¸</h3>
          <code>GET /api/ping</code>
        </div>
        <div class="section-content">
          <p>ë°±ì—”ë“œ ì„œë²„ì˜ ê¸°ë³¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
          <button id="pingServerButton" onclick="pingServer()">ì„œë²„ ìƒíƒœ í™•ì¸</button>
          <div id="pingServerResult" class="result"></div>
        </div>
      </div>

      <!-- ComfyUI ì—°ê²° í…ŒìŠ¤íŠ¸ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ¨ ComfyUI ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
          <code>GET /api/test-comfyui</code>
        </div>
        <div class="section-content">
          <p>ComfyUI ì„œë²„ì˜ ì—°ê²° ìƒíƒœì™€ ì‘ë‹µ ì‹œê°„ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
          <button id="testComfyUIButton" onclick="testComfyUIConnection()">ComfyUI ì„œë²„ í…ŒìŠ¤íŠ¸</button>
          <div id="testComfyUIResult" class="result"></div>
        </div>
      </div>

      <!-- Gemini AI í…ŒìŠ¤íŠ¸ (v3.0 ì—…ë°ì´íŠ¸) -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ¤– Gemini AI í…ŒìŠ¤íŠ¸ (v3.0)</h3>
          <code>Gemini 2.5 Flash Preview - JSON ì‘ë‹µ</code>
        </div>
        <div class="section-content">
          <div class="v3-highlight">
            <h4>v3.0 Gemini AI ê°œì„ ì‚¬í•­</h4>
            <ul>
              <li><strong>JSON êµ¬ì¡°í™”ëœ ì‘ë‹µ:</strong> {TEXT: string, PERSON: string}</li>
              <li><strong>Temperature 0.85, TopP 0.65:</strong> ë” ì°½ì˜ì ì´ê³  ì¼ê´€ëœ ì‘ë‹µ</li>
              <li><strong>24,576 í† í° Thinking Budget:</strong> ë” ê¹Šì´ ìˆëŠ” ë¶„ì„</li>
              <li><strong>Few-shot ì˜ˆì œ:</strong> ì¼ê´€ì„± ìˆëŠ” ì¥ë©´ ë¬˜ì‚¬</li>
            </ul>
          </div>
          <p>v3.0 JSON ê¸°ë°˜ Gemini AIì˜ ì—°ê²° ìƒíƒœì™€ ì‘ë‹µì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
          <div class="form-group">
            <label for="testGeminiContent">í…ŒìŠ¤íŠ¸ ì¼ê¸° ë‚´ìš© (@íƒœê·¸ ì§€ì›)</label>
            <textarea id="testGeminiContent" rows="3" placeholder="@ì¹œêµ¬ì™€ ê³µì›ì—ì„œ ì‚°ì±…í–ˆë‹¤. ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ë‹¤.">@ì¹œêµ¬ì™€ ê³µì›ì—ì„œ ì‚°ì±…í–ˆë‹¤. ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ë‹¤.</textarea>
          </div>
          <button id="testGeminiButton" onclick="testGeminiAI()">v3.0 Gemini AI JSON í…ŒìŠ¤íŠ¸</button>
          <div id="testGeminiResult" class="result"></div>
        </div>
      </div>

      <!-- API ì „ì²´ ìƒíƒœ ìš”ì•½ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ“Š API ìƒíƒœ ìš”ì•½</h3>
          <code>ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ</code>
        </div>
        <div class="section-content">
          <p>ëª¨ë“  ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ì™€ ì™¸ë¶€ ì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ í•œë²ˆì— í™•ì¸í•©ë‹ˆë‹¤.</p>
          <button id="fullSystemCheckButton" onclick="fullSystemCheck()">ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</button>
          <div id="fullSystemCheckResult" class="result"></div>
        </div>
      </div>

      <!-- í† í° ìƒíƒœ -->
      <div class="section">
        <div class="section-header">
          <h3>ğŸ”‘ ì¸ì¦ ìƒíƒœ</h3>
          <code>JWT Token Status</code>
        </div>
        <div class="section-content">
          <div id="tokenStatus" style="padding: 15px; background-color: #f8f9fa; border-radius: 6px; margin-bottom: 15px;">
            <strong>í˜„ì¬ í† í° ìƒíƒœ:</strong> <span id="tokenStatusText">í™•ì¸ ì¤‘...</span>
          </div>
          <button onclick="checkTokenStatus()">í† í° ìƒíƒœ í™•ì¸</button>
          <button onclick="clearToken()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">í† í° ì‚­ì œ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API ê¸°ë³¸ ì„¤ì •
    const API_URL = 'http://localhost:5000/api';
    let authToken = localStorage.getItem('authToken');
    let lastSceneData = null; // v3.0: JSON ì¥ë©´ ë¬˜ì‚¬ ë°ì´í„° ì €ì¥ {TEXT: string, PERSON: string}
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      checkServerStatus();
      checkTokenStatus();
      // v3.0: ì¸ë¬¼ ëª©ë¡ ìë™ ë¡œë“œ (ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰)
      setTimeout(() => {
        if (authToken) {
          loadMyPeopleForSelection();
        }
      }, 500);
    });
    
    // íƒ­ ê¸°ëŠ¥
    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("show");
      }
      
      const tablinks = document.getElementsByClassName("tablinks");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }
      
      document.getElementById(tabName).classList.add("show");
      evt.currentTarget.classList.add("active");
    }
    
    // ì„œë²„ ìƒíƒœ í™•ì¸
    async function checkServerStatus() {
      try {
        const response = await fetch(`${API_URL}/ping`);
        const data = await response.json();
        
        const statusElement = document.getElementById('connectionStatus');
        if (response.ok && data.status === 'ok') {
          statusElement.innerHTML = '<span class="status-indicator status-online"></span>ì„œë²„ ì—°ê²° ìƒíƒœ: ì˜¨ë¼ì¸';
        } else {
          statusElement.innerHTML = '<span class="status-indicator status-offline"></span>ì„œë²„ ì—°ê²° ìƒíƒœ: ì˜¤í”„ë¼ì¸';
        }
      } catch (error) {
        const statusElement = document.getElementById('connectionStatus');
        statusElement.innerHTML = '<span class="status-indicator status-offline"></span>ì„œë²„ ì—°ê²° ìƒíƒœ: ì—°ê²° ì‹¤íŒ¨';
      }
    }
    
    // ë²„íŠ¼ ë¡œë”© ìƒíƒœ ê´€ë¦¬
    function setButtonLoading(buttonId, isLoading, originalText = null) {
      const button = document.getElementById(buttonId);
      if (!button) return;
      
      if (isLoading) {
        button.disabled = true;
        button.originalText = button.textContent;
        button.textContent = "ì²˜ë¦¬ ì¤‘...";
      } else {
        button.disabled = false;
        button.textContent = originalText || button.originalText || button.textContent;
      }
    }
    
    // ê²°ê³¼ í‘œì‹œ í—¬í¼ í•¨ìˆ˜
    function displayResult(elementId, data, isSuccess = true) {
      const element = document.getElementById(elementId);
      element.textContent = JSON.stringify(data, null, 2);
      element.className = `result ${isSuccess ? 'success' : 'error'}`;
    }
    
    // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function registerUser() {
      try {
        setButtonLoading('registerButton', true);
        
        const username = document.getElementById('registerUsername').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const gender = document.getElementById('registerGender').value;
        const profilePhoto = document.getElementById('registerProfilePhoto').files[0];
        
        if (!username || !email || !password || !gender) {
          displayResult('registerResult', { error: 'í•„ìˆ˜ í•„ë“œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('username', username);
        formData.append('email', email);
        formData.append('password', password);
        formData.append('gender', gender);
        if (profilePhoto) {
          formData.append('profilePhoto', profilePhoto);
        }
        
        const response = await fetch(`${API_URL}/users/register`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        displayResult('registerResult', data, response.ok);
        
        if (response.ok && data.token) {
          localStorage.setItem('authToken', data.token);
          authToken = data.token;
          alert('íšŒì›ê°€ì… ì„±ê³µ! ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          // íšŒì›ê°€ì… ì„±ê³µ í›„ ì¸ë¬¼ ëª©ë¡ ìë™ ë¡œë“œ
          setTimeout(() => {
            loadMyPeopleForSelection();
          }, 500);
        }
      } catch (err) {
        displayResult('registerResult', { error: err.message }, false);
      } finally {
        setButtonLoading('registerButton', false);
      }
    }
    
    async function loginUser() {
      try {
        setButtonLoading('loginButton', true);
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        if (!email || !password) {
          displayResult('loginResult', { error: 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/login`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        displayResult('loginResult', data, response.ok);
        
        if (response.ok && data.token) {
          localStorage.setItem('authToken', data.token);
          authToken = data.token;
          alert('ë¡œê·¸ì¸ ì„±ê³µ!');
          // ë¡œê·¸ì¸ ì„±ê³µ í›„ ì¸ë¬¼ ëª©ë¡ ìë™ ë¡œë“œ
          setTimeout(() => {
            loadMyPeopleForSelection();
          }, 500);
        }
      } catch (err) {
        displayResult('loginResult', { error: err.message }, false);
      } finally {
        setButtonLoading('loginButton', false);
      }
    }
    
    async function getUserProfile() {
      try {
        setButtonLoading('getProfileButton', true);
        
        if (!authToken) {
          displayResult('profileResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/profile`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('profileResult', data, response.ok);
      } catch (err) {
        displayResult('profileResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getProfileButton', false);
      }
    }
    
    async function updateUserProfilePhoto() {
      try {
        setButtonLoading('updateProfileButton', true);
        
        if (!authToken) {
          displayResult('updateProfileResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const profilePhoto = document.getElementById('updateProfilePhoto').files[0];
        if (!profilePhoto) {
          displayResult('updateProfileResult', { error: 'í”„ë¡œí•„ ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('profilePhoto', profilePhoto);
        
        const response = await fetch(`${API_URL}/users/profile/photo`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updateProfileResult', data, response.ok);
      } catch (err) {
        displayResult('updateProfileResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateProfileButton', false);
      }
    }
    
    async function updateUserInfo() {
      try {
        setButtonLoading('updateUserInfoButton', true);
        
        if (!authToken) {
          displayResult('updateUserInfoResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const username = document.getElementById('updateUsername').value;
        const email = document.getElementById('updateEmail').value;
        
        if (!username && !email) {
          displayResult('updateUserInfoResult', { error: 'ìˆ˜ì •í•  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const updateData = {};
        if (username) updateData.username = username;
        if (email) updateData.email = email;
        
        const response = await fetch(`${API_URL}/users/profile`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        });
        
        const data = await response.json();
        displayResult('updateUserInfoResult', data, response.ok);
      } catch (err) {
        displayResult('updateUserInfoResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateUserInfoButton', false);
      }
    }
    
    async function changePassword() {
      try {
        setButtonLoading('changePasswordButton', true);
        
        if (!authToken) {
          displayResult('changePasswordResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        
        if (!currentPassword || !newPassword) {
          displayResult('changePasswordResult', { error: 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/users/profile/password`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });
        
        const data = await response.json();
        displayResult('changePasswordResult', data, response.ok);
      } catch (err) {
        displayResult('changePasswordResult', { error: err.message }, false);
      } finally {
        setButtonLoading('changePasswordButton', false);
      }
    }
    
    // ì¸ë¬¼ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function addPerson() {
      try {
        setButtonLoading('addPersonButton', true);
        
        if (!authToken) {
          displayResult('addPersonResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const name = document.getElementById('personName').value;
        const gender = document.getElementById('personGender').value;
        const photo = document.getElementById('personPhoto').files[0];
        
        if (!name || !photo) {
          displayResult('addPersonResult', { error: 'ì´ë¦„ê³¼ ì‚¬ì§„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('name', name);
        if (gender) formData.append('gender', gender);
        formData.append('photo', photo);
        
        const response = await fetch(`${API_URL}/people`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('addPersonResult', data, response.ok);
        
        if (response.ok) {
          // í¼ ì´ˆê¸°í™”
          document.getElementById('personName').value = '';
          document.getElementById('personGender').value = '';
          document.getElementById('personPhoto').value = '';
        }
      } catch (err) {
        displayResult('addPersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('addPersonButton', false);
      }
    }
    
    async function getMyPeople() {
      try {
        setButtonLoading('getMyPeopleButton', true);
        
        if (!authToken) {
          displayResult('myPeopleResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('myPeopleResult', data, response.ok);
      } catch (err) {
        displayResult('myPeopleResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMyPeopleButton', false);
      }
    }
    
    async function searchPeople() {
      try {
        setButtonLoading('searchPeopleButton', true);
        
        if (!authToken) {
          displayResult('searchPeopleResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const keyword = document.getElementById('personSearchKeyword').value;
        if (!keyword) {
          displayResult('searchPeopleResult', { error: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people/search?keyword=${encodeURIComponent(keyword)}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('searchPeopleResult', data, response.ok);
      } catch (err) {
        displayResult('searchPeopleResult', { error: err.message }, false);
      } finally {
        setButtonLoading('searchPeopleButton', false);
      }
    }
    
    async function getPersonById() {
      try {
        setButtonLoading('getPersonButton', true);
        
        if (!authToken) {
          displayResult('getPersonResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('getPersonResult', { error: 'ì¸ë¬¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('getPersonResult', data, response.ok);
        
        if (response.ok && data) {
          // ìˆ˜ì • í¼ì— ê¸°ì¡´ ì •ë³´ ì±„ìš°ê¸°
          document.getElementById('updatePersonName').value = data.name || '';
          document.getElementById('updatePersonGender').value = data.gender || '';
        }
      } catch (err) {
        displayResult('getPersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getPersonButton', false);
      }
    }
    
    async function updatePerson() {
      try {
        setButtonLoading('updatePersonButton', true);
        
        if (!authToken) {
          displayResult('updatePersonResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('updatePersonResult', { error: 'ì¸ë¬¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const name = document.getElementById('updatePersonName').value;
        const gender = document.getElementById('updatePersonGender').value;
        const photo = document.getElementById('updatePersonPhoto').files[0];
        
        const formData = new FormData();
        if (name) formData.append('name', name);
        if (gender) formData.append('gender', gender);
        if (photo) formData.append('photo', photo);
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updatePersonResult', data, response.ok);
      } catch (err) {
        displayResult('updatePersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updatePersonButton', false);
      }
    }
    
    async function deletePerson() {
      try {
        if (!authToken) {
          displayResult('updatePersonResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('personId').value;
        if (!id) {
          displayResult('updatePersonResult', { error: 'ì¸ë¬¼ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        if (!confirm('ì •ë§ë¡œ ì´ ì¸ë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          return;
        }
        
        setButtonLoading('deletePersonButton', true);
        
        const response = await fetch(`${API_URL}/people/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('updatePersonResult', data, response.ok);
        
        if (response.ok) {
          // í¼ ì´ˆê¸°í™”
          document.getElementById('personId').value = '';
          document.getElementById('updatePersonName').value = '';
          document.getElementById('updatePersonGender').value = '';
          document.getElementById('updatePersonPhoto').value = '';
        }
      } catch (err) {
        displayResult('updatePersonResult', { error: err.message }, false);
      } finally {
        setButtonLoading('deletePersonButton', false);
      }
    }
    
    // ì¼ê¸° ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function createDiary() {
      try {
        setButtonLoading('createDiaryButton', true);
        
        if (!authToken) {
          displayResult('createDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const content = document.getElementById('diaryContent').value;
        const diaryDate = document.getElementById('diaryDate').value;
        const artStyleId = document.getElementById('diaryArtStyle').value;
        const photos = document.getElementById('diaryPhotos').files;
        
        // v3.0 í•„ë“œë“¤
        const sceneDescription = document.getElementById('sceneDescription').value;
        const userAppearanceKeywords = document.getElementById('userAppearanceKeywords').value;
        const mainCharacterGender = document.getElementById('mainCharacterGender').value;
        
        if (!content || !artStyleId || !userAppearanceKeywords) {
          displayResult('createDiaryResult', { error: 'v3.0: ì¼ê¸° ë‚´ìš©, í™”í’, ì‚¬ìš©ì ì™¸ëª¨ í‚¤ì›Œë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const formData = new FormData();
        formData.append('content', content);
        formData.append('artStyleId', artStyleId);
        formData.append('userAppearanceKeywords', userAppearanceKeywords);
        if (diaryDate) formData.append('diaryDate', diaryDate);
        if (sceneDescription) formData.append('sceneDescription', sceneDescription);
        if (mainCharacterGender) formData.append('mainCharacterGender', mainCharacterGender);
        
        // v3.0: JSON ì¥ë©´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì „ë‹¬
        if (lastSceneData) {
          if (lastSceneData.PERSON) {
            formData.append('extractedProtagonist', lastSceneData.PERSON);
            console.log('v3.0 ì£¼ì¸ê³µ ì „ë‹¬:', lastSceneData.PERSON);
          }
          console.log('v3.0 JSON ë°ì´í„° ì „ë‹¬:', lastSceneData);
        }
        
        for (let i = 0; i < photos.length; i++) {
          formData.append('photos', photos[i]);
        }
        
        console.log('v3.0 ì¼ê¸° ì‘ì„± ìš”ì²­ ì‹œì‘');
        
        const response = await fetch(`${API_URL}/diaries`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        console.log('v3.0 ì¼ê¸° ì‘ì„± ì‘ë‹µ:', data);
        
        displayResult('createDiaryResult', data, response.ok);
        
        // ìƒì„±ëœ ì´ë¯¸ì§€ í‘œì‹œ
        if (response.ok && data.diary && data.diary.generatedImage) {
          const imageContainer = document.getElementById('generatedDiaryImage');
          const img = document.createElement('img');
          img.src = data.diary.generatedImage.startsWith('http') ? data.diary.generatedImage : 
                   data.diary.generatedImage.startsWith('/') ? `http://localhost:5000${data.diary.generatedImage}` : 
                   `http://localhost:5000/${data.diary.generatedImage}`;
          img.alt = 'v3.0 ìƒì„±ëœ ì¼ê¸° ì´ë¯¸ì§€';
          img.style.maxWidth = '100%';
          img.style.maxHeight = '400px';
          img.style.border = '1px solid #ddd';
          img.style.borderRadius = '5px';
          img.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
          
          imageContainer.innerHTML = '<h4>v3.0 ìƒì„±ëœ ì´ë¯¸ì§€:</h4>';
          imageContainer.appendChild(img);
        }
        
        if (response.ok) {
          // í¼ ì´ˆê¸°í™”
          document.getElementById('diaryContent').value = '';
          document.getElementById('diaryDate').value = '';
          document.getElementById('diaryArtStyle').value = '';
          document.getElementById('sceneDescription').value = '';
          document.getElementById('userAppearanceKeywords').value = '';
          document.getElementById('mainCharacterGender').value = '';
          document.getElementById('diaryPhotos').value = '';
          
          // v3.0 ì €ì¥ëœ ë°ì´í„° ì´ˆê¸°í™”
          lastSceneData = null;
          console.log('v3.0 ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
        }
      } catch (err) {
        console.error('v3.0 ì¼ê¸° ì‘ì„± ì˜¤ë¥˜:', err);
        displayResult('createDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('createDiaryButton', false);
      }
    }
    
    async function getMyDiaries() {
      try {
        setButtonLoading('getMyDiariesButton', true);
        
        if (!authToken) {
          displayResult('myDiariesResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const page = document.getElementById('diaryPage').value || 1;
        const limit = document.getElementById('diaryLimit').value || 10;
        
        const response = await fetch(`${API_URL}/diaries?page=${page}&limit=${limit}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('myDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('myDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMyDiariesButton', false);
      }
    }
    
    async function getMonthlyDiaries() {
      try {
        setButtonLoading('getMonthlyDiariesButton', true);
        
        if (!authToken) {
          displayResult('monthlyDiariesResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const year = document.getElementById('monthlyYear').value;
        const month = document.getElementById('monthlyMonth').value;
        
        if (!year || !month) {
          displayResult('monthlyDiariesResult', { error: 'ë…„ë„ì™€ ì›”ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/monthly?year=${year}&month=${month}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('monthlyDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('monthlyDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getMonthlyDiariesButton', false);
      }
    }
    
    async function searchDiaries() {
      try {
        setButtonLoading('searchDiaryButton', true);
        
        if (!authToken) {
          displayResult('searchDiariesResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const keyword = document.getElementById('diarySearchKeyword').value;
        if (!keyword) {
          displayResult('searchDiariesResult', { error: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/search?keyword=${encodeURIComponent(keyword)}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('searchDiariesResult', data, response.ok);
      } catch (err) {
        displayResult('searchDiariesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('searchDiaryButton', false);
      }
    }
    
    async function getDiaryById() {
      try {
        setButtonLoading('getDiaryButton', true);
        
        if (!authToken) {
          displayResult('getDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('getDiaryResult', { error: 'ì¼ê¸° IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('getDiaryResult', data, response.ok);
        
        if (response.ok && data) {
          // ìˆ˜ì • í¼ì— ê¸°ì¡´ ì •ë³´ ì±„ìš°ê¸°
          document.getElementById('updateDiaryContent').value = data.content || '';
        }
      } catch (err) {
        displayResult('getDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getDiaryButton', false);
      }
    }
    
    async function updateDiary() {
      try {
        setButtonLoading('updateDiaryButton', true);
        
        if (!authToken) {
          displayResult('updateDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('updateDiaryResult', { error: 'ì¼ê¸° IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const content = document.getElementById('updateDiaryContent').value;
        const photos = document.getElementById('updateDiaryPhotos').files;
        
        const formData = new FormData();
        if (content) formData.append('content', content);
        
        for (let i = 0; i < photos.length; i++) {
          formData.append('photos', photos[i]);
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        displayResult('updateDiaryResult', data, response.ok);
      } catch (err) {
        displayResult('updateDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('updateDiaryButton', false);
      }
    }
    
    async function deleteDiary() {
      try {
        if (!authToken) {
          displayResult('updateDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('updateDiaryResult', { error: 'ì¼ê¸° IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        if (!confirm('ì •ë§ë¡œ ì´ ì¼ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          return;
        }
        
        setButtonLoading('deleteDiaryButton', true);
        
        const response = await fetch(`${API_URL}/diaries/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('updateDiaryResult', data, response.ok);
        
        if (response.ok) {
          // í¼ ì´ˆê¸°í™”
          document.getElementById('diaryId').value = '';
          document.getElementById('updateDiaryContent').value = '';
          document.getElementById('updateDiaryPhotos').value = '';
        }
      } catch (err) {
        displayResult('updateDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('deleteDiaryButton', false);
      }
    }
    
    async function getDiaryPromptLog() {
      try {
        setButtonLoading('getPromptLogButton', true);
        
        if (!authToken) {
          displayResult('promptLogResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const id = document.getElementById('diaryId').value;
        if (!id) {
          displayResult('promptLogResult', { error: 'ì¼ê¸° IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/${id}/prompt-log`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('promptLogResult', data, response.ok);
      } catch (err) {
        displayResult('promptLogResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getPromptLogButton', false);
      }
    }
    
    // ì‹œìŠ¤í…œ ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function pingServer() {
      try {
        setButtonLoading('pingServerButton', true);
        
        const response = await fetch(`${API_URL}/ping`);
        const data = await response.json();
        displayResult('pingServerResult', data, response.ok);
      } catch (err) {
        displayResult('pingServerResult', { error: err.message }, false);
      } finally {
        setButtonLoading('pingServerButton', false);
      }
    }
    
    async function testComfyUIConnection() {
      try {
        setButtonLoading('testComfyUIButton', true);
        
        const response = await fetch(`${API_URL}/test-comfyui`);
        const data = await response.json();
        displayResult('testComfyUIResult', data, response.ok);
      } catch (err) {
        displayResult('testComfyUIResult', { error: err.message }, false);
      } finally {
        setButtonLoading('testComfyUIButton', false);
      }
    }
    
    async function fullSystemCheck() {
      try {
        setButtonLoading('fullSystemCheckButton', true);
        
        const results = {
          timestamp: new Date().toISOString(),
          checks: {}
        };
        
        // ì„œë²„ ìƒíƒœ í™•ì¸
        try {
          const pingResponse = await fetch(`${API_URL}/ping`);
          const pingData = await pingResponse.json();
          results.checks.server = {
            status: pingResponse.ok ? 'OK' : 'FAIL',
            response: pingData,
            responseTime: 'N/A'
          };
        } catch (err) {
          results.checks.server = {
            status: 'FAIL',
            error: err.message
          };
        }
        
        // ComfyUI ìƒíƒœ í™•ì¸
        try {
          const comfyResponse = await fetch(`${API_URL}/test-comfyui`);
          const comfyData = await comfyResponse.json();
          results.checks.comfyui = {
            status: comfyResponse.ok ? 'OK' : 'FAIL',
            response: comfyData
          };
        } catch (err) {
          results.checks.comfyui = {
            status: 'FAIL',
            error: err.message
          };
        }
        
        // Gemini AI ìƒíƒœ í™•ì¸ (v3.0 ì—…ë°ì´íŠ¸)
        if (authToken) {
          try {
            const geminiTestBody = {
              content: 'í…ŒìŠ¤íŠ¸ ì¼ê¸° ë‚´ìš©',
              protagonistName: 'í…ŒìŠ¤íŠ¸',
              sceneDirectionHint: 'ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸'
            };
            
            const geminiResponse = await fetch(`${API_URL}/diaries/generate-scene`, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(geminiTestBody)
            });
            
            const geminiData = await geminiResponse.json();
            results.checks.geminiAI = {
              status: geminiResponse.ok ? 'OK' : 'FAIL',
              model: 'gemini-2.5-flash-preview-05-20',
              response: geminiData
            };
          } catch (err) {
            results.checks.geminiAI = {
              status: 'FAIL',
              model: 'gemini-2.5-flash-preview-05-20',
              error: err.message
            };
          }
        } else {
          results.checks.geminiAI = {
            status: 'NO_TOKEN',
            message: 'ì¸ì¦ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.'
          };
        }
        
        // ì¸ì¦ ìƒíƒœ í™•ì¸
        if (authToken) {
          try {
            const authResponse = await fetch(`${API_URL}/users/profile`, {
              headers: { 'Authorization': `Bearer ${authToken}` }
            });
            results.checks.authentication = {
              status: authResponse.ok ? 'OK' : 'FAIL',
              hasToken: true,
              tokenValid: authResponse.ok
            };
          } catch (err) {
            results.checks.authentication = {
              status: 'FAIL',
              hasToken: true,
              tokenValid: false,
              error: err.message
            };
          }
        } else {
          results.checks.authentication = {
            status: 'NO_TOKEN',
            hasToken: false,
            message: 'í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'
          };
        }
        
        displayResult('fullSystemCheckResult', results, true);
      } catch (err) {
        displayResult('fullSystemCheckResult', { error: err.message }, false);
      } finally {
        setButtonLoading('fullSystemCheckButton', false);
      }
    }
    
    function checkTokenStatus() {
      const tokenStatusText = document.getElementById('tokenStatusText');
      
      if (authToken) {
        try {
          // JWT í† í° ë””ì½”ë”© (ê°„ë‹¨í•œ ë°©ë²•)
          const payload = JSON.parse(atob(authToken.split('.')[1]));
          const now = Math.floor(Date.now() / 1000);
          const isExpired = payload.exp < now;
          
          tokenStatusText.innerHTML = `
            <span style="color: ${isExpired ? '#dc3545' : '#28a745'};">
              ${isExpired ? 'ë§Œë£Œë¨' : 'ìœ íš¨í•¨'}
            </span>
            <br><small>ë§Œë£Œ ì‹œê°„: ${new Date(payload.exp * 1000).toLocaleString()}</small>
          `;
        } catch (err) {
          tokenStatusText.innerHTML = '<span style="color: #dc3545;">í† í° í˜•ì‹ ì˜¤ë¥˜</span>';
        }
      } else {
        tokenStatusText.innerHTML = '<span style="color: #6c757d;">í† í° ì—†ìŒ</span>';
      }
    }
    
    function clearToken() {
      if (confirm('ì €ì¥ëœ í† í°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.')) {
        localStorage.removeItem('authToken');
        authToken = null;
        checkTokenStatus();
        alert('í† í°ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // í™”í’ ëª©ë¡ ì¡°íšŒ
    async function getArtStyles() {
      try {
        setButtonLoading('getArtStylesButton', true);
        
        if (!authToken) {
          displayResult('artStylesResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/art-styles`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        displayResult('artStylesResult', data, response.ok);
      } catch (err) {
        displayResult('artStylesResult', { error: err.message }, false);
      } finally {
        setButtonLoading('getArtStylesButton', false);
      }
    }
    
    // í™”í’ ëª©ë¡ì„ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ì—¬ select ì˜µì…˜ ì—…ë°ì´íŠ¸
    async function loadArtStyles() {
      try {
        if (!authToken) {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          return;
        }
        
        const response = await fetch(`${API_URL}/diaries/art-styles`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          const select = document.getElementById('diaryArtStyle');
          
          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
          while (select.children.length > 1) {
            select.removeChild(select.lastChild);
          }
          
          // ìƒˆ ì˜µì…˜ ì¶”ê°€
          if (data.artStyles && Array.isArray(data.artStyles)) {
            data.artStyles.forEach(style => {
              const option = document.createElement('option');
              option.value = style.id;
              option.textContent = `${style.name} (${style.description || style.id})`;
              select.appendChild(option);
            });
            alert('í™”í’ ëª©ë¡ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        } else {
          alert('í™”í’ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (err) {
        alert('í™”í’ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
      }
    }
    
     // v3.0 ì¥ë©´ ë¬˜ì‚¬ ìƒì„± (JSON ê¸°ë°˜)
    async function generateSceneDescription() {
      try {
        setButtonLoading('generateSceneButton', true);
        
        if (!authToken) {
          displayResult('sceneGenerationResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const content = document.getElementById('sceneContent').value;
        
        if (!content) {
          displayResult('sceneGenerationResult', { error: 'ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' }, false);
          return;
        }
        
        const requestBody = {
          content: content
        };
        
        console.log('v3.0 ì¥ë©´ ë¬˜ì‚¬ ìš”ì²­:', requestBody);
        
        const response = await fetch(`${API_URL}/diaries/generate-scene`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
        
        const data = await response.json();
        console.log('v3.0 ì¥ë©´ ë¬˜ì‚¬ ì‘ë‹µ:', data);
        
        displayResult('sceneGenerationResult', data, response.ok);
        
        // v3.0: JSON ì‘ë‹µ ì²˜ë¦¬ (ìƒˆë¡œìš´ ì‘ë‹µ êµ¬ì¡°)
        if (response.ok && data.sceneDescription && data.identifiedPerson) {
          // ì¼ê¸° ì‘ì„± í¼ì˜ ì¥ë©´ ë¬˜ì‚¬ ì¹¸ì— ìë™ ì…ë ¥
          const sceneDescField = document.getElementById('sceneDescription');
          if (sceneDescField) {
            sceneDescField.value = data.sceneDescription;
          }
          
          // v3.0 JSON ë°ì´í„° ì €ì¥ (ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ)
          lastSceneData = {
            TEXT: data.sceneDescription,
            PERSON: data.identifiedPerson,
            sceneDescription: data.sceneDescription,
            identifiedPerson: data.identifiedPerson
          };
          
          console.log('v3.0 JSON ì¥ë©´ ë°ì´í„° ì €ì¥ë¨:', lastSceneData);
          
          // ì„±ê³µ íŒì—… í‘œì‹œ
          if (confirm(`âœ… í…ŒìŠ¤íŠ¸ìš© JSON ì¥ë©´ ë¬˜ì‚¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì£¼ì¸ê³µ: ${data.identifiedPerson}\nì¥ë©´: ${data.sceneDescription.substring(0, 100)}${data.sceneDescription.length > 100 ? '...' : ''}\n\nğŸ“ ì¼ê¸° ì‘ì„± ì„¹ì…˜ìœ¼ë¡œ ì´ë™í•˜ê³  ë‚´ìš©ì„ ìë™ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            // ì¼ê¸° ì‘ì„± í¼ì— ë‚´ìš© ìë™ ì…ë ¥
            const diaryContentField = document.getElementById('diaryContent');
            if (diaryContentField && !diaryContentField.value) {
              diaryContentField.value = document.getElementById('sceneContent').value;
            }
            
            // ì¼ê¸° ì„¹ì…˜ìœ¼ë¡œ ìë™ ì´ë™
            const diaryTab = document.querySelector('button[onclick="openTab(event, \'diarySection\')"]');
            if (diaryTab) {
              diaryTab.click();
            }
          }
        }
      } catch (err) {
        console.error('v3.0 ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì˜¤ë¥˜:', err);
        displayResult('sceneGenerationResult', { error: err.message }, false);
      } finally {
        setButtonLoading('generateSceneButton', false);
             }
     }
     
    // v3.0 ì¼ê¸° ì‘ì„± (ê¸°ì¡´ ì¸ë¬¼ ì„ íƒ ë°©ì‹)
    async function createDiary() {
      try {
        setButtonLoading('createDiaryButton', true);
        
        if (!authToken) {
          displayResult('createDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        const content = document.getElementById('diaryContent').value;
        const diaryDate = document.getElementById('diaryDate').value;
        const artStyleId = document.getElementById('diaryArtStyle').value;
        const photos = document.getElementById('diaryPhotos').files;
        
        // v3.0 í•„ë“œë“¤
        const sceneDescription = document.getElementById('sceneDescription').value;
        const selectedMainCharacter = document.getElementById('selectedMainCharacter').value;
        const userAppearanceKeywords = document.getElementById('userAppearanceKeywords').value;
        
        if (!content || !artStyleId || !sceneDescription || !selectedMainCharacter || !userAppearanceKeywords) {
          displayResult('createDiaryResult', { error: 'v3.0: ì¼ê¸° ë‚´ìš©, í™”í’, ì¥ë©´ ë¬˜ì‚¬, ì£¼ìš” ì¸ë¬¼, ì‚¬ìš©ì ì™¸ëª¨ í‚¤ì›Œë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' }, false);
          return;
        }
        
        // v3.0: lastSceneDataì—ì„œ identifiedPerson ê°€ì ¸ì˜¤ê¸°
        let identifiedPerson = null;
        if (lastSceneData && lastSceneData.identifiedPerson) {
          identifiedPerson = lastSceneData.identifiedPerson;
        } else if (lastSceneData && lastSceneData.PERSON) {
          identifiedPerson = lastSceneData.PERSON;
        }
        
        if (!identifiedPerson) {
          displayResult('createDiaryResult', { error: 'ë¨¼ì € ì¥ë©´ ë¬˜ì‚¬ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”. ì‹ë³„ëœ ì¸ë¬¼ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
          return;
        }
        
        console.log('ì‚¬ìš©í•  identifiedPerson:', identifiedPerson);
        
        const formData = new FormData();
        formData.append('content', content);
        formData.append('artStyleId', artStyleId);
        formData.append('sceneDescription', sceneDescription);
        formData.append('identifiedPerson', identifiedPerson);
        formData.append('selectedPersonId', selectedMainCharacter);
        formData.append('userAppearanceKeywords', userAppearanceKeywords);
        if (diaryDate) formData.append('diaryDate', diaryDate);
        
        for (let i = 0; i < photos.length; i++) {
          formData.append('photos', photos[i]);
        }
        
        // ë””ë²„ê¹…: FormData ë‚´ìš© ì¶œë ¥
        console.log('v3.0 ì¼ê¸° ì‘ì„± ìš”ì²­ ì‹œì‘ (ê¸°ì¡´ ì¸ë¬¼ ì„ íƒ ë°©ì‹)');
        console.log('FormData ë‚´ìš©:');
        for (let [key, value] of formData.entries()) {
          console.log(`${key}:`, value);
        }
        
        const response = await fetch(`${API_URL}/diaries`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}` },
          body: formData
        });
        
        const data = await response.json();
        console.log('v3.0 ì¼ê¸° ì‘ì„± ì‘ë‹µ:', data);
        
        displayResult('createDiaryResult', data, response.ok);
        
        // ìƒì„±ëœ ì´ë¯¸ì§€ í‘œì‹œ
        if (response.ok && data.diary && data.diary.generatedImage) {
          const imageContainer = document.getElementById('generatedDiaryImage');
          const img = document.createElement('img');
          img.src = data.diary.generatedImage.startsWith('http') ? data.diary.generatedImage : 
                   data.diary.generatedImage.startsWith('/') ? `http://localhost:5000${data.diary.generatedImage}` : 
                   `http://localhost:5000/${data.diary.generatedImage}`;
          img.alt = 'v3.0 ìƒì„±ëœ ì¼ê¸° ì´ë¯¸ì§€';
          img.style.maxWidth = '100%';
          img.style.maxHeight = '400px';
          img.style.border = '1px solid #ddd';
          img.style.borderRadius = '5px';
          img.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
          
          imageContainer.innerHTML = '<h4>v3.0 ìƒì„±ëœ ì´ë¯¸ì§€:</h4>';
          imageContainer.appendChild(img);
        }
        
        if (response.ok) {
          // í¼ ì´ˆê¸°í™”
          document.getElementById('diaryContent').value = '';
          document.getElementById('diaryDate').value = '';
          document.getElementById('diaryArtStyle').value = '';
          document.getElementById('sceneDescription').value = '';
          document.getElementById('selectedMainCharacter').value = '';
          document.getElementById('userAppearanceKeywords').value = '';
          document.getElementById('diaryPhotos').value = '';
          
          // v3.0 ì €ì¥ëœ ë°ì´í„° ì´ˆê¸°í™”
          lastSceneData = null;
          console.log('v3.0 ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
        }
      } catch (err) {
        console.error('v3.0 ì¼ê¸° ì‘ì„± ì˜¤ë¥˜:', err);
        displayResult('createDiaryResult', { error: err.message }, false);
      } finally {
        setButtonLoading('createDiaryButton', false);
      }
    }
    
         // v3.0 ì¼ê¸° ë‚´ìš©ìœ¼ë¡œ ì¥ë©´ ë¬˜ì‚¬ ìƒì„±
     async function generateSceneFromDiary() {
       try {
         // ë²„íŠ¼ ë¡œë”© ìƒíƒœ ì„¤ì • (ì„±ê³µí•˜ëŠ” ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ)
         const generateButton = document.querySelector('button[onclick="generateSceneFromDiary()"]');
         if (generateButton) {
           generateButton.disabled = true;
           generateButton.textContent = "ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì¤‘...";
         }
         
         const diaryContent = document.getElementById('diaryContent').value;
         if (!diaryContent) {
           alert('ë¨¼ì € ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
           return;
         }
         
         if (!authToken) {
           alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
           return;
         }
         
         const requestBody = {
           content: diaryContent
         };
         
         console.log('v3.0 ì¥ë©´ ë¬˜ì‚¬ ìš”ì²­:', requestBody);
         
         const response = await fetch(`${API_URL}/diaries/generate-scene`, {
           method: 'POST',
           headers: {
             'Authorization': `Bearer ${authToken}`,
             'Content-Type': 'application/json'
           },
           body: JSON.stringify(requestBody)
         });
         
         const data = await response.json();
         console.log('v3.0 ì¥ë©´ ë¬˜ì‚¬ ì‘ë‹µ:', data);
         
         if (response.ok && data.sceneDescription && data.identifiedPerson) {
           // ì¥ë©´ ë¬˜ì‚¬ ì¹¸ì— ìë™ ì…ë ¥
           const sceneDescField = document.getElementById('sceneDescription');
           if (sceneDescField) {
             sceneDescField.value = data.sceneDescription;
           }
           
           // v3.0 JSON ë°ì´í„° ì €ì¥ (ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ)
           lastSceneData = {
             TEXT: data.sceneDescription,
             PERSON: data.identifiedPerson,
             sceneDescription: data.sceneDescription,
             identifiedPerson: data.identifiedPerson
           };
           
           console.log('v3.0 JSON ì¥ë©´ ë°ì´í„° ì €ì¥ë¨:', lastSceneData);
           
           // ì„±ê³µ íŒì—… í‘œì‹œ
           alert(`âœ… ì¥ë©´ ë¬˜ì‚¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì£¼ì¸ê³µ: ${data.identifiedPerson}\nì¥ë©´: ${data.sceneDescription.substring(0, 100)}${data.sceneDescription.length > 100 ? '...' : ''}\n\në‹¤ìŒ ë‹¨ê³„: ì£¼ìš” ì¸ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`);
           
         } else {
           throw new Error(data.message || 'ì¥ë©´ ë¬˜ì‚¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
         }
         
       } catch (err) {
         console.error('ì¼ê¸° ë‚´ìš©ìœ¼ë¡œ ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì˜¤ë¥˜:', err);
         alert('âŒ ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
       } finally {
         // ë²„íŠ¼ ìƒíƒœ ë³µì›
         const generateButton = document.querySelector('button[onclick="generateSceneFromDiary()"]');
         if (generateButton) {
           generateButton.disabled = false;
           generateButton.textContent = "2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±";
         }
       }
     }
     
     // v3.0 ë‚´ ì¸ë¬¼ ëª©ë¡ì„ ì„ íƒ ì˜µì…˜ìœ¼ë¡œ ë¡œë“œ
     async function loadMyPeopleForSelection() {
       try {
         if (!authToken) {
           console.log('í† í°ì´ ì—†ì–´ ì¸ë¬¼ ëª©ë¡ ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
           return;
         }
         
         const response = await fetch(`${API_URL}/people`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
         });
         
         if (response.ok) {
           const data = await response.json();
           const select = document.getElementById('selectedMainCharacter');
           
           if (!select) {
             console.log('selectedMainCharacter ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
             return;
           }
           
           // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
           while (select.children.length > 1) {
             select.removeChild(select.lastChild);
           }
           
           // ìƒˆ ì˜µì…˜ ì¶”ê°€
           if (data.people && Array.isArray(data.people)) {
             console.log('ì¸ë¬¼ ëª©ë¡ ë¡œë“œ:', data.people);
             data.people.forEach(person => {
               const option = document.createElement('option');
               option.value = person._id;
               option.textContent = `${person.name} (${person.gender || 'ì„±ë³„ ë¯¸ì§€ì •'})`;
               select.appendChild(option);
             });
             console.log(`${data.people.length}ê°œì˜ ì¸ë¬¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
           } else {
             console.log('ì¸ë¬¼ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤:', data);
           }
         } else {
           const errorData = await response.json();
           console.error('ì¸ë¬¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', errorData);
           alert('ì¸ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (errorData.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
         }
       } catch (err) {
         console.error('ì¸ë¬¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', err);
         alert('ì¸ë¬¼ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
       }
     }

     // v3.0 í”¼ë“œë°±ì´ ìˆëŠ” ì¸ë¬¼ ëª©ë¡ ë¡œë“œ (ë²„íŠ¼ í´ë¦­ìš©)
     async function loadMyPeopleForSelectionWithFeedback() {
       try {
         if (!authToken) {
           alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
           return;
         }
         
         const response = await fetch(`${API_URL}/people`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
         });
         
         if (response.ok) {
           const data = await response.json();
           const select = document.getElementById('selectedMainCharacter');
           
           if (!select) {
             alert('ì¸ë¬¼ ì„ íƒ ë“œë¡­ë‹¤ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
             return;
           }
           
           // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
           while (select.children.length > 1) {
             select.removeChild(select.lastChild);
           }
           
           // ìƒˆ ì˜µì…˜ ì¶”ê°€
           if (data.people && Array.isArray(data.people)) {
             if (data.people.length > 0) {
               data.people.forEach(person => {
                 const option = document.createElement('option');
                 option.value = person._id;
                 option.textContent = `${person.name} (${person.gender || 'ì„±ë³„ ë¯¸ì§€ì •'})`;
                 select.appendChild(option);
               });
               alert(`${data.people.length}ê°œì˜ ì¸ë¬¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
             } else {
               alert('ë“±ë¡ëœ ì¸ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì¸ë¬¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
             }
           } else {
             alert('ì¸ë¬¼ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
           }
         } else {
           const errorData = await response.json();
           alert('ì¸ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (errorData.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
         }
       } catch (err) {
         alert('ì¸ë¬¼ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
       }
     }

     // v3.0 Gemini AI í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
     async function testGeminiAI() {
       try {
         setButtonLoading('testGeminiButton', true);
         
         if (!authToken) {
           displayResult('testGeminiResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
           return;
         }
         
        const content = document.getElementById('testGeminiContent').value || '@ì¹œêµ¬ì™€ ê³µì›ì—ì„œ ì‚°ì±…í–ˆë‹¤. ë‚ ì”¨ê°€ ì •ë§ ì¢‹ì•˜ë‹¤.';
         
         const requestBody = {
          content: content
         };
        
        console.log('v3.0 Gemini í…ŒìŠ¤íŠ¸ ìš”ì²­:', requestBody);
         
         const startTime = Date.now();
         const response = await fetch(`${API_URL}/diaries/generate-scene`, {
           method: 'POST',
           headers: {
             'Authorization': `Bearer ${authToken}`,
             'Content-Type': 'application/json'
           },
           body: JSON.stringify(requestBody)
         });
         const endTime = Date.now();
         
         const data = await response.json();
         
        // v3.0 ì‘ë‹µ ë¶„ì„
         const testResult = {
           ...data,
           responseTime: `${endTime - startTime}ms`,
           geminiModel: 'gemini-2.5-flash-preview-05-20',
          version: 'v3.0',
          features: {
            jsonStructured: !!(data.sceneDescription && data.identifiedPerson),
            smartTagSupport: true,
            thinkingBudget: '24,576 tokens',
            temperature: 0.85,
            topP: 0.65
          },
           testTimestamp: new Date().toISOString()
         };
        
        console.log('v3.0 Gemini í…ŒìŠ¤íŠ¸ ê²°ê³¼:', testResult);
         
         displayResult('testGeminiResult', testResult, response.ok);
       } catch (err) {
        console.error('v3.0 Gemini í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', err);
         displayResult('testGeminiResult', { error: err.message }, false);
       } finally {
         setButtonLoading('testGeminiButton', false);
       }
     }

     // v3.0.1 ê°„ì†Œí™”ëœ ì¼ê¸° ë‚´ìš©ìœ¼ë¡œ ì¥ë©´ ë¬˜ì‚¬ ìƒì„±
     let lastSimpleSceneData = null; // ê°„ì†Œí™”ëœ ë²„ì „ìš© ë³„ë„ ë³€ìˆ˜
     
     async function generateSceneFromSimpleDiary() {
       try {
         // ë²„íŠ¼ ë¡œë”© ìƒíƒœ ì„¤ì •
         const generateButton = document.querySelector('button[onclick="generateSceneFromSimpleDiary()"]');
         if (generateButton) {
           generateButton.disabled = true;
           generateButton.textContent = "ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì¤‘...";
         }
         
         const diaryContent = document.getElementById('simpleDiaryContent').value;
         if (!diaryContent) {
           alert('ë¨¼ì € ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
           return;
         }
         
         if (!authToken) {
           alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
           return;
         }
         
         const requestBody = {
           content: diaryContent
         };
         
         console.log('v3.0.1 ê°„ì†Œí™”ëœ ì¥ë©´ ë¬˜ì‚¬ ìš”ì²­:', requestBody);
         
         const response = await fetch(`${API_URL}/diaries/generate-scene`, {
           method: 'POST',
           headers: {
             'Authorization': `Bearer ${authToken}`,
             'Content-Type': 'application/json'
           },
           body: JSON.stringify(requestBody)
         });
         
         const data = await response.json();
         console.log('v3.0.1 ê°„ì†Œí™”ëœ ì¥ë©´ ë¬˜ì‚¬ ì‘ë‹µ:', data);
         
         if (response.ok && data.sceneDescription && data.identifiedPerson) {
           // ì¥ë©´ ë¬˜ì‚¬ ì¹¸ì— ìë™ ì…ë ¥
           const sceneDescField = document.getElementById('simpleSceneDescription');
           if (sceneDescField) {
             sceneDescField.value = data.sceneDescription;
           }
           
           // ê°„ì†Œí™”ëœ ë²„ì „ìš© JSON ë°ì´í„° ì €ì¥
           lastSimpleSceneData = {
             sceneDescription: data.sceneDescription,
             identifiedPerson: data.identifiedPerson
           };
           
           console.log('v3.0.1 ê°„ì†Œí™”ëœ JSON ì¥ë©´ ë°ì´í„° ì €ì¥ë¨:', lastSimpleSceneData);
           
           // ì„±ê³µ íŒì—… í‘œì‹œ
           alert(`âœ… ì¥ë©´ ë¬˜ì‚¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì£¼ì¸ê³µ: ${data.identifiedPerson}\nì¥ë©´: ${data.sceneDescription.substring(0, 100)}${data.sceneDescription.length > 100 ? '...' : ''}\n\në‹¤ìŒ ë‹¨ê³„: ì£¼ì¸ê³µ ì„±ë³„ê³¼ ì™¸ëª¨ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
           
         } else {
           throw new Error(data.message || 'ì¥ë©´ ë¬˜ì‚¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
         }
         
       } catch (err) {
         console.error('ê°„ì†Œí™”ëœ ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì˜¤ë¥˜:', err);
         alert('âŒ ì¥ë©´ ë¬˜ì‚¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
       } finally {
         // ë²„íŠ¼ ìƒíƒœ ë³µì›
         const generateButton = document.querySelector('button[onclick="generateSceneFromSimpleDiary()"]');
         if (generateButton) {
           generateButton.disabled = false;
           generateButton.textContent = "2ë‹¨ê³„: ì¥ë©´ ë¬˜ì‚¬ ìë™ ìƒì„±";
         }
       }
     }

     // v3.0.1 ê°„ì†Œí™”ëœ ì¼ê¸° ì‘ì„± (selectedPersonId ì—†ì´)
     async function createSimpleDiary() {
       try {
         setButtonLoading('createSimpleDiaryButton', true);
         
         if (!authToken) {
           displayResult('createSimpleDiaryResult', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
           return;
         }
         
         const content = document.getElementById('simpleDiaryContent').value;
         const diaryDate = document.getElementById('simpleDiaryDate').value;
         const artStyleId = document.getElementById('simpleDiaryArtStyle').value;
         const photos = document.getElementById('simpleDiaryPhotos').files;
         
         // v3.0.1 ê°„ì†Œí™”ëœ í•„ë“œë“¤
         const sceneDescription = document.getElementById('simpleSceneDescription').value;
         const mainCharacterGender = document.getElementById('simpleMainCharacterGender').value;
         const userAppearanceKeywords = document.getElementById('simpleUserAppearanceKeywords').value;
         
         if (!content || !artStyleId || !sceneDescription || !mainCharacterGender || !userAppearanceKeywords) {
           displayResult('createSimpleDiaryResult', { error: 'v3.0.1: ì¼ê¸° ë‚´ìš©, í™”í’, ì¥ë©´ ë¬˜ì‚¬, ì£¼ì¸ê³µ ì„±ë³„, ì™¸ëª¨ í‚¤ì›Œë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.' }, false);
           return;
         }
         
         // identifiedPerson í™•ì¸
         let identifiedPerson = null;
         if (lastSimpleSceneData && lastSimpleSceneData.identifiedPerson) {
           identifiedPerson = lastSimpleSceneData.identifiedPerson;
         }
         
         if (!identifiedPerson) {
           displayResult('createSimpleDiaryResult', { error: 'ë¨¼ì € ì¥ë©´ ë¬˜ì‚¬ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”. ì‹ë³„ëœ ì¸ë¬¼ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
           return;
         }
         
         console.log('v3.0.1 ê°„ì†Œí™”ëœ ë°©ì‹ - identifiedPerson:', identifiedPerson);
         
         const formData = new FormData();
         formData.append('content', content);
         formData.append('artStyleId', artStyleId);
         formData.append('sceneDescription', sceneDescription);
         formData.append('identifiedPerson', identifiedPerson);
         formData.append('mainCharacterGender', mainCharacterGender);
         formData.append('userAppearanceKeywords', userAppearanceKeywords);
         if (diaryDate) formData.append('diaryDate', diaryDate);
         
         // selectedPersonIdëŠ” ì œì™¸ (ê°„ì†Œí™”ëœ ë°©ì‹)
         
         for (let i = 0; i < photos.length; i++) {
           formData.append('photos', photos[i]);
         }
         
         // ë””ë²„ê¹…: FormData ë‚´ìš© ì¶œë ¥
         console.log('v3.0.1 ê°„ì†Œí™”ëœ ì¼ê¸° ì‘ì„± ìš”ì²­ ì‹œì‘');
         console.log('FormData ë‚´ìš©:');
         for (let [key, value] of formData.entries()) {
           console.log(`${key}:`, value);
         }
         
         const response = await fetch(`${API_URL}/diaries`, {
           method: 'POST',
           headers: { 'Authorization': `Bearer ${authToken}` },
           body: formData
         });
         
         const data = await response.json();
         console.log('v3.0.1 ê°„ì†Œí™”ëœ ì¼ê¸° ì‘ì„± ì‘ë‹µ:', data);
         
         displayResult('createSimpleDiaryResult', data, response.ok);
         
         // ìƒì„±ëœ ì´ë¯¸ì§€ í‘œì‹œ
         if (response.ok && data.diary && data.diary.generatedImage) {
           const imageContainer = document.getElementById('generatedSimpleDiaryImage');
           const img = document.createElement('img');
           img.src = data.diary.generatedImage.startsWith('http') ? data.diary.generatedImage : 
                    data.diary.generatedImage.startsWith('/') ? `http://localhost:5000${data.diary.generatedImage}` : 
                    `http://localhost:5000/${data.diary.generatedImage}`;
           img.alt = 'v3.0.1 ê°„ì†Œí™”ëœ ë°©ì‹ìœ¼ë¡œ ìƒì„±ëœ ì¼ê¸° ì´ë¯¸ì§€';
           img.style.maxWidth = '100%';
           img.style.maxHeight = '400px';
           img.style.border = '1px solid #ddd';
           img.style.borderRadius = '5px';
           img.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
           
           imageContainer.innerHTML = '<h4>v3.0.1 ê°„ì†Œí™”ëœ ë°©ì‹ìœ¼ë¡œ ìƒì„±ëœ ì´ë¯¸ì§€:</h4>';
           imageContainer.appendChild(img);
           
           // ì„±ê³µ ì•Œë¦¼
           alert('âœ… ê°„ì†Œí™”ëœ ë°©ì‹ìœ¼ë¡œ ì¼ê¸°ì™€ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
         }
         
         if (response.ok) {
           // í¼ ì´ˆê¸°í™”
           document.getElementById('simpleDiaryContent').value = '';
           document.getElementById('simpleDiaryDate').value = '';
           document.getElementById('simpleDiaryArtStyle').value = '';
           document.getElementById('simpleSceneDescription').value = '';
           document.getElementById('simpleMainCharacterGender').value = '';
           document.getElementById('simpleUserAppearanceKeywords').value = '';
           document.getElementById('simpleDiaryPhotos').value = '';
           
           // ì €ì¥ëœ ë°ì´í„° ì´ˆê¸°í™”
           lastSimpleSceneData = null;
           console.log('v3.0.1 ê°„ì†Œí™”ëœ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
         }
       } catch (err) {
         console.error('v3.0.1 ê°„ì†Œí™”ëœ ì¼ê¸° ì‘ì„± ì˜¤ë¥˜:', err);
         displayResult('createSimpleDiaryResult', { error: err.message }, false);
       } finally {
         setButtonLoading('createSimpleDiaryButton', false);
       }
     }

  </script>
</body>
</html> 